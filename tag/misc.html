<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <title>Season of Code - Misc</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="shortcut icon" href="https://seasonofcode.com/assets/favicon.ico" />
      <link href="https://seasonofcode.com/theme/asciidoc.min.css?0e298cf5" rel="stylesheet" />
    <link href="https://seasonofcode.com/theme/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://seasonofcode.com/theme/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
      <link href="https://seasonofcode.com/theme/style.min.css?918c51a9" rel="stylesheet" />
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://seasonofcode.com/theme/html5shiv.min.js"></script>
    <script src="https://seasonofcode.com/theme/respond.min.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://seasonofcode.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Season of Code Full Atom Feed" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-21264754-1', 'auto');
  ga('send', 'pageview');

</script>

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(["setDomains", ["*.seasonofcode.com"]]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//analytics.chu4n.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 2]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//analytics.chu4n.com/piwik.php?idsite=2" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

    <meta name="google-site-verification" content="g_MrQjKfWWKOccQYg--leY8NlSev0om0sy2vrBLYoZU">
    <meta name="google-site-verification" content="_r0m7LYlH2JjDgeTysX9Fv0OzQG1xUEAU6x2uSr9nH8">

    <meta name="msvalidate.01" content="F10D3C66876F50983761BFE53E2B943A4">

  <meta name="robots" content="noindex, follow">
  </head>
  <body id="index" class="archive">
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <nav id="header" class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <i class="fa fa-bars fa-lg"></i>
          </button>
          <a class="navbar-brand" href="https://seasonofcode.com">
            season <span class="of">of</span> code
          </a>
        </div>
        <div class="collapse navbar-collapse navbar-right">
          <ul class="nav navbar-nav">
            <li>
              <a href="https://seasonofcode.com/tag/featured.html">Featured</a>
            </li>
            <li id="header-tags-dropdown" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                role="button">Tags <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu">
                  <li><a href="https://seasonofcode.com/tag/android.html">Android</a></li>
                  <li><a href="https://seasonofcode.com/tag/c.html">C++</a></li>
                  <li><a href="https://seasonofcode.com/tag/featured.html">Featured</a></li>
                  <li><a href="https://seasonofcode.com/tag/linux.html">Linux</a></li>
                  <li><a href="https://seasonofcode.com/tag/misc.html">Misc</a></li>
                  <li><a href="https://seasonofcode.com/tag/projects.html">Projects</a></li>
                  <li><a href="https://seasonofcode.com/tag/python.html">Python</a></li>
                  <li><a href="https://seasonofcode.com/tag/window-manager.html">Window Manager</a></li>
              </ul>
            </li>
            <li>
              <a href="https://seasonofcode.com/archives.html">Archives</a>
            </li>
            <li><a href="https://seasonofcode.com/pages/about.html">About</a></li>
          </ul>
        </div>
        <!-- /.navbar-collapse -->
      </div>
    </nav>
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-8 col-md-offset-2">
    <section id="content" class="content">
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="https://seasonofcode.com/posts/setting-up-dkim-and-srs-in-postfix.html" rel="bookmark">
      Setting Up DKIM And SRS In Postfix
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2014-12-09T17:25:00-08:00">
          Dec 09, 2014
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="https://seasonofcode.com/tag/misc.html">Misc</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="https://seasonofcode.com/posts/setting-up-dkim-and-srs-in-postfix.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>In my previous post
<a href="/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html"><em>Custom
Domain E-mails With Postfix And Gmail: The Missing Tutorial</em></a>, we set up a
Postfix mail server on a custom domain that integrates seamlessly with Gmail.</p></div>
<div class="paragraph"><p>However, the tutorial skipped two important security standards that will help
prevent e-mails routed through our server from being marked as spam:
<a href="http://en.wikipedia.org/wiki/DomainKeys_Identified_Mail">DKIM</a> and
<a href="http://en.wikipedia.org/wiki/Sender_Rewriting_Scheme">SRS</a>. This article will
show you how to add support for DKIM and SRS to a Postfix server.</p></div>
<div class="paragraph"><p>Similar to the
<a href="/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html">previous
tutorial</a>, we will assume a Ubuntu server in our examples.</p></div>
<div class="sect2">
<h3 id="_step_1_dkim">Step 1: DKIM</h3>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/DomainKeys_Identified_Mail">DKIM</a>, short for
<em>DomainKeys Identified Mail</em>, is a mechanism for</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
A sender e-mail program to sign an outgoing e-mail message, and
</p>
</li>
<li>
<p>
A recipient e-mail program to verify said signature.
</p>
</li>
</ol></div>
<div class="paragraph"><p>More concretely, let&#8217;s say Gmail receives an e-mail message from
<code>myserver.example.com</code>. DKIM allows Gmail to verify that the e-mail was indeed
sent by the designated e-mail server program on <code>myserver.example.com</code>, and not
by, say, a virus running on <code>myserver.example.com</code> or a malicious user who
happens to have access to <code>myserver.example.com</code>.</p></div>
<div class="paragraph"><p>We will use <a href="http://www.opendkim.org/">OpenDKIM</a> for this tutorial. To install
OpenDKIM on Ubuntu:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo apt-get install opendkim opendkim-tools
</pre></div></div></div>
<div class="sect3">
<h4 id="_code_etc_opendkim_conf_code"><code>/etc/opendkim.conf</code></h4>
<div class="paragraph"><p>Edit <code>/etc/opendkim.conf</code> to match the following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># OpenDKIM config.</span>

<span class="c"># Log to syslog</span>
Syslog                  yes
SyslogSuccess           yes
LogWhy                  yes
<span class="c"># Required to use local socket with MTAs that access the socket as a non-</span>
<span class="c"># privileged user (e.g. Postfix)</span>
UMask                   002

Mode                    sv
PidFile                 /var/run/opendkim/opendkim.pid
UserID                  opendkim:opendkim
Socket                  inet:12301@localhost

Canonicalization        relaxed/simple
SignatureAlgorithm      rsa-sha256

<span class="c"># Sign for example.com with key in /etc/opendkim.d/mail.private using</span>
<span class="c"># selector &#39;mail&#39; (e.g. mail._domainkey.example.com)</span>
Domain                  example.com
KeyFile                 /etc/opendkim.d/mail.private
Selector                mail

ExternalIgnoreList      refile:/etc/opendkim.d/TrustedHosts
InternalHosts           refile:/etc/opendkim.d/TrustedHosts
</pre></div></div></div>
<div class="paragraph"><p>You can check out a detailed explanation for the meaning of each option with <code>man
opendkim.conf</code>.</p></div>
</div>
<div class="sect3">
<h4 id="_code_etc_opendkim_d_trustedhosts_code"><code>/etc/opendkim.d/TrustedHosts</code></h4>
<div class="paragraph"><p>Create the directory <code>/etc/opendkim.d</code> and put the following in
<code>/etc/opendkim.d/TrustedHosts</code>. This instructs the OpenDKIM server to sign
e-mails delivered by any server matching these expressions (such as
<code>myserver_2.example.com</code>).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>127.0.0.1
::1
localhost
192.168.0.1/24

*.example.com
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_dkim_keys">DKIM keys</h4>
<div class="paragraph"><p>Now, let&#8217;s generate our DKIM signing keys:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> /etc/opendkim.d
<span class="nv">$ </span>sudo opendkim-genkey -s mail -d example.com
</pre></div></div></div>
<div class="paragraph"><p>This will produce two files in <code>/etc/opendkim.d</code>: our private key,
<code>mail.private</code>, and our public key, <code>mail.txt</code>.</p></div>
<div class="paragraph"><p>We should make sure only OpenDKIM can read the private key, so that a malicious
program or user on the same server won&#8217;t be able to forge our signature:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>chmod <span class="m">600</span> mail.private
<span class="nv">$ </span>chown opendkim:opendkim mail.private
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_dkim_public_key_dns_record">DKIM public key DNS record</h4>
<div class="paragraph"><p>The next step is to publish our public key through DNS, so that any recipient
e-mail program can verify our signature. If we look at our public key <code>mail.txt</code>
generated in the previous step, it should look like something like this:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>mail._domainkey IN      TXT     ( "v=DKIM1; k=rsa; "
          "p=&lt;alphabetical soup&gt;" )  ; ----- DKIM key mail for example.com</code></pre>
</div></div>
<div class="paragraph"><p>Create the following <strong>TXT</strong> DNS record for <code>example.com</code> (how to update DNS
records will depend on the DNS hosting provider):</p></div>
<div class="ulist"><ul>
<li>
<p>
Name: <code>mail._domainkey.example.com</code>
</p>
</li>
<li>
<p>
Value: <code>v=DKIM1; k=rsa; p=&lt;alphabetical soup&gt;</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>where <code>&lt;alphabetical soup&gt;</code> is the public key found in <code>mail.txt</code> after <code>p=</code>.
Note that DNS records will take a while (depending on our provider, up to a day)
to propagate.</p></div>
</div>
<div class="sect3">
<h4 id="_opendkim_server">OpenDKIM server</h4>
<div class="paragraph"><p>We can now start the OpenDKIM server with</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo /etc/init.d/opendkim start
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_postfix">Postfix</h4>
<div class="paragraph"><p>The last step is to tell Postfix to use OpenDKIM to sign outgoing e-mail
messages. Add the following to <code>/etc/postfix/main.cf</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># Milter settings.</span>
<span class="nv">milter_protocol</span> <span class="o">=</span> 2
<span class="nv">milter_default_action</span> <span class="o">=</span> accept
<span class="c"># OpenDKIM runs on port 12301.</span>
<span class="nv">smtpd_milters</span> <span class="o">=</span> inet:localhost:12301
<span class="nv">non_smtpd_milters</span> <span class="o">=</span> inet:localhost:12301
</pre></div></div></div>
<div class="paragraph"><p>If you already have other milters configured (such as
<a href="http://spamassassin.apache.org/">SpamAssassin</a>), simply add
<code>inet:localhost:12301</code> to your existing <code>smtpd_milters</code> and <code>non_smtpd_milters</code>
lines, prefixed by a comma.</p></div>
<div class="paragraph"><p>Let&#8217;s now restart Postfix with the new configuration:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo postfix reload
</pre></div></div></div>
<div class="paragraph"><p>&#8230;and we&#8217;re done!</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_srs">Step 2: SRS</h3>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Sender_Rewriting_Scheme">SRS</a>, short for <em>Sender
Rewriting Scheme</em>, is a standard for including forwarding / relay information in
a forwarded / relayed e-mail message.</p></div>
<div class="paragraph"><p>For example, suppose <code>alice@hotmail.com</code> sends an e-mail to <code>john@example.com</code>,
and our Postfix server on <code>myserver.example.com</code> forwards this e-mail to
<code>john123@gmail.com</code>. SRS allows our Postfix server on <code>myserver.example.com</code> to
attach a virtual sticky note on the e-mail message explaining this situation to
Gmail. Otherwise, Gmail might become suspicious of why <code>myserver.example.com</code> is
producing messages that purport to come from <code>hotmail.com</code>, which spammers and
phishers are wont to do.</p></div>
<div class="paragraph"><p>We will use <a href="https://github.com/roehling/postsrsd">PostSRSd</a> to implement SRS in
our Postfix server. It works out of the box with Postfix and is a breeze to set
up, but unfortunately is not included in the official Ubuntu / Debian package
repositories.</p></div>
<div class="sect3">
<h4 id="_opensrsd">OpenSRSd</h4>
<div class="paragraph"><p>Let&#8217;s build and install OpenSRSd from source:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># Dependencies.</span>
<span class="nv">$ </span>sudo apt-get install unzip cmake

<span class="c"># Download and extract source code from GitHub.</span>
<span class="nv">$ </span><span class="nb">cd</span> /tmp
<span class="nv">$ </span>curl -L -o postsrsd.zip <span class="se">\</span>
    https://github.com/roehling/postsrsd/archive/master.zip
<span class="nv">$ </span>unzip postsrsd.zip

<span class="c"># Build and install.</span>
<span class="nv">$ </span><span class="nb">cd </span>postsrsd-master
<span class="nv">$ </span>mkdir build
<span class="nv">$ </span><span class="nb">cd </span>build
<span class="nv">$ </span>cmake -DCMAKE_INSTALL_PREFIX<span class="o">=</span>/usr ../
<span class="nv">$ </span>make
<span class="nv">$ </span>sudo make install
</pre></div></div></div>
<div class="paragraph"><p>The default config provided by PostSRSd (<code>/etc/default/postsrsd</code>) will pretty
much work out of the box for our case.</p></div>
<div class="paragraph"><p>The install script will also conveniently install an Upstart script for
PostSRSd. Let&#8217;s start it now:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo service postsrsd start
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_postfix_2">Postfix</h4>
<div class="paragraph"><p>Finally, we configure Postfix to use PostSRSd. Add the following to
<code>/etc/postfix/main.cf</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># PostSRSd settings.</span>
<span class="nv">sender_canonical_maps</span> <span class="o">=</span> tcp:localhost:10001
<span class="nv">sender_canonical_classes</span> <span class="o">=</span> envelope_sender
<span class="nv">recipient_canonical_maps</span> <span class="o">=</span> tcp:localhost:10002
<span class="nv">recipient_canonical_classes</span><span class="o">=</span> envelope_recipient,header_recipient
</pre></div></div></div>
<div class="paragraph"><p>And restart Postfix with the new configuration:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo postfix reload
</pre></div></div></div>
<div class="paragraph"><p>That&#8217;s it!</p></div>
</div>
</div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Dec 09, 2014
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="https://seasonofcode.com/tag/misc.html">Misc</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="https://seasonofcode.com/posts/setting-up-dkim-and-srs-in-postfix.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="https://seasonofcode.com/posts/setting-up-dkim-and-srs-in-postfix.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="https://seasonofcode.com/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html" rel="bookmark">
      Custom Domain E-mails With Postfix and Gmail: The Missing Tutorial
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2014-11-06T16:50:00-08:00">
          Nov 06, 2014
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="https://seasonofcode.com/tag/featured.html">Featured</a>,            <a href="https://seasonofcode.com/tag/misc.html">Misc</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="https://seasonofcode.com/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>Custom domain e-mail addresses, like <code>john@johnscompany.com</code>, are cool and
professional-looking. Would <em>you</em> want to e-mail potential clients as
<code>john123@gmail.com</code>?</p></div>
<div class="paragraph"><p>On the other hand, Gmail has great reliability, speed, spam filtration, and app
support. Wouldn&#8217;t it be great if we could send and receive e-mail as
<code>john@johnscompany.com</code>, but right from the comfort of our Gmail account?</p></div>
<div class="paragraph"><p>Today, if we want to <strong>use Gmail to send and receive e-mails on a custom domain</strong>,
we have a couple of options:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><a href="http://www.google.com/work/apps/business/">Google Apps for Work</a></strong> is Google&#8217;s
  own offering. It&#8217;s simple to set up and manage, but it&#8217;s pretty pricey at
  $5/mo per user, especially if we don&#8217;t need the bundled collaborative
  features like Google Docs and Calendar.
</p>
</li>
<li>
<p>
<strong>Third-party services</strong> could get the job done at a
  lower price point; for example, <a href="https://pobox.com/">Pobox</a> offers plans
  starting at $20/yr. The downside is that we will have to trust another
  organization with our e-mail.
</p>
</li>
<li>
<p>
<strong>Set up our own e-mail forwarding server</strong>. It&#8217;s fairly easy (if we
  follow this guide :) and if we already have shared / dedicated hosting or a
  VPS, this is basically free and gives us total control over our e-mail.
</p>
</li>
</ul></div>
<div class="paragraph"><p>If you want to host <strong>custom domain e-mails in Gmail without paying for Google
Apps</strong> or a third-party service, this tutorial is for you. It will show you how
to quickly set up you own e-mail forwarding / relay server, and how to integrate
it seamlessly with Gmail.</p></div>
<div class="sect2">
<h3 id="_prerequisites">Prerequisites</h3>
<div class="paragraph"><p>For this tutorial, we&#8217;ll assume we have access to:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>VPS or shared / dedicated hosting</strong>, with a dedicated IP address and capable
  of listening on ports 25 and 587. We will use a Ubuntu server for
  the examples.
</p>
</li>
<li>
<p>
<strong>DNS records for our domain</strong>. How DNS records are manipulated depends on the
  DNS hosting provider (or DNS server configuration).
</p>
</li>
</ul></div>
<div class="paragraph"><p>We&#8217;ll assume</p></div>
<div class="ulist"><ul>
<li>
<p>
We have a domain <code>example.com</code>;
</p>
</li>
<li>
<p>
We have a server <code>myserver.example.com</code>;
</p>
</li>
<li>
<p>
We want to use the Gmail account <code>john123@gmail.com</code> to manage
  <code>john@example.com</code>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_step_1_dns_setup">Step 1: DNS Setup</h3>
<div class="paragraph"><p>The first step in setting up our e-mail forwarding server is to add MX, PTR and
<a href="http://en.wikipedia.org/wiki/Sender_Policy_Framework">SPF</a> DNS records for our
server. This is really important as many e-mail providers, in order to prevent
spam, will refuse to talk to mail servers without proper MX, PTR and SPF records
set up. How to update DNS records will depend on the DNS hosting provider.</p></div>
<div class="paragraph"><p>The following is what we need:</p></div>
<div class="ulist"><ul>
<li>
<p>
An <strong>MX</strong> record for <code>example.com</code>, pointing to <code>myserver.example.com</code>.
</p>
<div class="paragraph"><p>This tells the world that e-mails to <code>&lt;whatever&gt;@example.com</code> should be
delivered to the server <code>myserver.example.com</code>.</p></div>
</li>
<li>
<p>
An <strong>A</strong> record for <code>myserver.example.com</code>, pointing to the IP address of our
  server.
</p>
</li>
<li>
<p>
A <strong>PTR</strong> (reverse DNS) record mapping the IP address of our server to
  <code>myserver.example.com</code>.
</p>
<div class="paragraph"><p>This allows Gmail to verify the legitimacy of our server via its IP when Gmail
receives a forwarded e-mail from it.</p></div>
</li>
<li>
<p>
A <strong>TXT</strong> record, with key <code>example.com</code> and value <code>v=spf1 mx ~all</code>.
</p>
<div class="paragraph"><p>This is an <a href="http://en.wikipedia.org/wiki/Sender_Policy_Framework">SPF</a> record; it
tells Gmail that the servers specified in the MX records of <code>example.com</code>, in
this case only <code>myserver.example.com</code>, are allowed to send e-mails purporting to
be from <code>&lt;whatever&gt;@example.com</code>. All other servers attempting to do the same
will be rejected. This should be a sane default value, but feel free to custom
it as you like.</p></div>
</li>
</ul></div>
<div class="paragraph"><p>DNS records will take a while (depending on our provider, up to a day) to
propagate. Until they do, e-mails forwarded by our new e-mail server may get
marked as spam or rejected outright.</p></div>
</div>
<div class="sect2">
<h3 id="_step_2_receiving_e_mail">Step 2: Receiving E-mail</h3>
<div class="paragraph"><p>We&#8217;ll first set up an e-mail forwarding server which will let we receive e-mails
sent to our domains.</p></div>
<div class="paragraph"><p>We will use <a href="http://www.postfix.org">Postfix</a> as the e-mail server. Let&#8217;s start by
installing the necessary packages. We will assume a Ubuntu server in the
examples below; if you&#8217;re using a different distribution, please consult your
distribution&#8217;s documentation for the right commands.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ sudo DEBIAN_FRONTEND=noninteractive apt-get install postfix</code></pre>
</div></div>
<div class="paragraph"><p>In the above command, we skip the <code>debconf</code> configuration UI with
<code>DEBIAN_FRONTEND=noninteractive</code> as we will edit the configuration files
directly.</p></div>
<div class="sect3">
<h4 id="_etc_postfix_main_cf">/etc/postfix/main.cf</h4>
<div class="paragraph"><p>Open up <code>/etc/postfix/main.cf</code> in your favorite editor. This file will come
pre-populated with a bunch of config options and comments.  Replace the contents
of the file with the following (you can comment out the original contents for
reference):</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># /etc/postfix/main.cf</span>

<span class="c"># Host and site name.</span>
<span class="n">myhostname</span> <span class="o">=</span> <span class="n">myserver</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">mydomain</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">myorigin</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>

<span class="c"># Virtual aliases.</span>
<span class="n">virtual_alias_domains</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">virtual_alias_maps</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">postfix</span><span class="o">/</span><span class="n">virtual</span>
</pre></div></div></div>
<div class="paragraph"><p>The first few lines are pretty straightforward; they tell Postfix how to
identify itself to the world. The last two lines tell Postfix to forward e-mails
sent to <code>&lt;whatever&gt;@example.com</code> to another e-mail provider (Gmail), and that the
forwarding is configured in the database file <code>/etc/postfix/virtual</code>.</p></div>
</div>
<div class="sect3">
<h4 id="_etc_postfix_virtual">/etc/postfix/virtual</h4>
<div class="paragraph"><p>Let&#8217;s now open up <code>/etc/postfix/virtual</code> and fill in our forwarding
configuration:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># /etc/postfix/virtual</span>

<span class="c"># Forwarding mapping, one from-to address pair per line. The format is:</span>
<span class="c">#     &lt;forward-from-addr&gt; &lt;whitespace&gt; &lt;forward-to-addr&gt;</span>
john@example.com        john123@gmail.com
</pre></div></div></div>
<div class="paragraph"><p>We can add as many forwarding rules as you want, one on each line.  We can use
any number of tabs / whitespaces between the forward-from and forward-to
addresses.</p></div>
</div>
<div class="sect3">
<h4 id="_update_lookup_table">Update lookup table</h4>
<div class="paragraph"><p>It turns out that Postfix doesn&#8217;t actually read <code>/etc/postfix/virtual</code>
(surprise!); instead, what it reads is a lookup table generated from it.
So, let&#8217;s generate the lookup table from our <code>/etc/postfix/virtual</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo postmap /etc/postfix/virtual
</pre></div></div></div>
<div class="paragraph"><p><strong>Note</strong>: we must re-run this command every time we modify
<code>/etc/postfix/virtual</code>!</p></div>
</div>
<div class="sect3">
<h4 id="_re_start_postfix">(Re)start Postfix</h4>
<div class="paragraph"><p>It&#8217;s now time to (re)start Postfix with our new configuration:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo postfix start
<span class="nv">$ </span>sudo postfix reload
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_testing">Testing</h4>
<div class="paragraph"><p>We should test our brand-new Postfix server by sending an e-mail to our
forward-from address. You might want to check out
<a href="http://articles.slicehost.com/2008/8/6/postfix-using-telnet-to-test-postfix">these</a>
<a href="https://workaround.org/ispmail/lenny/test-mail-through-telnet">tutorials</a> for
testing directly with the <code>telnet</code> command.</p></div>
<div class="paragraph"><p>If you received the e-mail in your Gmail inbox, congratulations! Otherwise,
check the Postfix logs at <code>/var/log/mail.log</code> (or with <code>journalctl -u postfix</code>
if using Systemd) for errors. The most likely cause of issues is that DNS
records have not propagated yet, in which case we&#8217;re likely to see a "rate
limited" or "rejected for spam" type error message.</p></div>
<div class="paragraph"><p>If we only want to <em>receive</em> but don&#8217;t care about <em>sending</em> e-mails as
<code>john@example.com</code>, then this is all we need.</p></div>
<div class="paragraph"><p>Otherwise, let&#8217;s move on to
configuring Postfix to support sending e-mails from Gmail.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_sending_e_mail">Step 3: Sending E-mail</h3>
<div class="paragraph"><p>Gmail requires a relay server (a server that will send e-mails to their
destination on behalf it) to speak
<a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a>, which protects the
communication between Gmail and the relay server.</p></div>
<div class="paragraph"><p>We will use <a href="http://www.cyrusimap.org/">Cyrus SASL</a> for this task. To install:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo apt-get install sasl2-bin libsasl2-modules
</pre></div></div></div>
<div class="sect3">
<h4 id="_user_name_amp_password">User name &amp; password</h4>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Open_mail_relay">Open relays</a> are a terrible idea.
We want to protect our e-mail server with a user name and password so that it
will let Gmail send e-mails through it, but block spammers and other evil
actors.</p></div>
<div class="paragraph"><p>Cyrus SASL supports several backends for storing user names and passwords,
including MySQL and PAM. However, we will go with the simplest backend&#8201;&#8212;&#8201;a
plain database file.</p></div>
<div class="paragraph"><p>Let&#8217;s create the user name / password database file in the default location
<code>/etc/sasldb2</code>, with a single user named <code>smtp</code> (we can change the user name to
anything we want):</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo saslpasswd2 -c -u example.com smtp
</pre></div></div></div>
<div class="paragraph"><p>Verify with:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo sasldblistusers2
</pre></div></div></div>
<div class="paragraph"><p>Now, we make sure only Postfix can read this file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo chmod <span class="m">400</span> /etc/sasldb2
<span class="nv">$ </span>sudo chown postfix /etc/sasldb2
</pre></div></div></div>
<div class="paragraph"><p>Lastly, we tell Cyrus SASL to use the file-based database to authenticate.
Create the file <code>/etc/postfix/sasl/smtpd.conf</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>pwcheck_method: auxprop
auxprop_plugin: sasldb
mech_list: PLAIN LOGIN CRAM-MD5 DIGEST-MD5 NTLM
log_level: 7</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_ssl_certificate">SSL Certificate</h4>
<div class="paragraph"><p>We need an SSL certificate to enable TLS. While a proper SSL certificate signed
by a Certificate Authority (CA) can be pricey, it turns out that a simple
self-signed certificate suffices and works just fine.</p></div>
<div class="paragraph"><p>So, let&#8217;s generate one.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<strong>Generate an RSA private/public key pair.</strong> Note that you MUST supply a password
  to this command; the password will be removed in step 3.
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>openssl genrsa -des3 -out example.key 1024
</pre></div></div></div>
</li>
<li>
<p>
<strong>Generate a Certificate Signing Request (CSR).</strong> Make sure to enter
  <code>myserver.example.com</code> when prompted for the "Common Name".
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>openssl req -new -key example.key -out example.csr
</pre></div></div></div>
</li>
<li>
<p>
<strong>Remove RSA private/public key password.</strong>
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>mv example.key example.key.orig
<span class="nv">$ </span>openssl rsa -in example.key.orig -out example.key
</pre></div></div></div>
</li>
<li>
<p>
<strong>Generate a self-signed certificate.</strong> In the example, the generated
  certificate will be valid for 10 years.
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>openssl x509 -req <span class="se">\</span>
    -days <span class="m">3650</span> -in example.csr -signkey example.key -out example.crt
</pre></div></div></div>
</li>
<li>
<p>
<strong>Create a PEM file.</strong>
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>cat example.crt example.key &gt; example.pem
</pre></div></div></div>
</li>
<li>
<p>
<strong>Move and protect the PEM file.</strong>
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo mv example.pem /etc/postfix/example.pem
<span class="nv">$ </span>sudo chmod <span class="m">400</span> /etc/postfix/example.pem
<span class="nv">$ </span>sudo chown postfix /etc/postfix/example.pem
</pre></div></div></div>
</li>
</ol></div>
<div class="paragraph"><p><strong>Note:</strong> Make sure to protect the generated private key and certificate with care!</p></div>
</div>
<div class="sect3">
<h4 id="_relay_server">Relay server</h4>
<div class="paragraph"><p>The final step is to configure Postfix to enable relaying of e-mail on behalf of
Gmail.</p></div>
<div class="paragraph"><p>Let&#8217;s open up <code>/etc/postfix/master.cf</code>. This file should already contain a bunch
of config options, some of which are commented out. Uncomment the lines starting
with <code>submission</code> and edit them to match the following:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>submission inet n       -       n       -       -       smtpd
  -o syslog_name=postfix/submission
  -o smtpd_tls_security_level=may
  -o smtpd_tls_cert_file=/etc/postfix/example.pem
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_reject_unlisted_recipient=no
  -o smtpd_relay_restrictions=permit_sasl_authenticated,reject
  -o milter_macro_daemon_name=ORIGINATING</code></pre>
</div></div>
<div class="paragraph"><p>A Postfix restart is due after all these changes:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo postfix reload
</pre></div></div></div>
<div class="paragraph"><p>If all went well, you should see Postfix serving a relay server, protected by
our user name and password in <code>/etc/sasldb2</code>, on port 587.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_configure_gmail">Step 4: Configure Gmail</h3>
<div class="paragraph"><p>Finally, let&#8217;s log in to Gmail and tell it about our brand new server. (Note
that the new Inbox UI does not yet support all the settings available in the
legacy interface at the time of writing, so these instructions apply to the
legacy interface.)</p></div>
<div class="paragraph"><p>Let&#8217;s go to <em>Settings</em> &gt; <em>Accounts and Import</em> and click <em>Add another email
address you own</em>.
<div align="center"><img src="/assets/files/gmail_1.png"></div>
In the dialog that pops up, fill in our target e-mail address and click <em>Next
Step</em>.
<div align="center"><img src="/assets/files/gmail_2.png"></div>
In the next dialog, enter the address of our e-mail server
(<code>myserver.example.com</code>), and the user name and password we set up using
<code>saslpasswd2</code> above. Make sure the user name is suffixed with our domain name
(so <code>smtp@example.com</code> rather than just <code>smtp</code>). Check that the correct port
(587) and the correct security protocol (TLS) are selected, then click <em>Add
Account</em>.
<div align="center"><img src="/assets/files/gmail_3.png"></div>
If all goes well, we should see a dialog like the following:
<div align="center"><img src="/assets/files/gmail_4.png"></div>
And we should receive an e-mail, forwarded by our mail server set up in the
first part, to our <code>john123@gmail.com</code> address. Click on the link inside the
e-mail and we&#8217;re done!</p></div>
<div class="paragraph"><p>Now, in any e-mail compose / reply window, you should be able to select
<code>john@example.com</code> in the drop-down list next to "From". Congrats!</p></div>
<div class="paragraph"><p>If, on the other hand, you see an error like the following:
<div align="center"><img src="/assets/files/gmail_5.png"></div>
You should check the Postfix logs at <code>/var/log/mail.log</code> (or with <code>journalctl -u
postfix</code> if using Systemd) for any errors.</p></div>
</div>
<div class="sect2">
<h3 id="_optional_step_5_setup_dkim_and_srs">[Optional] Step 5: Setup DKIM and SRS</h3>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/DomainKeys_Identified_Mail">DKIM</a>, short for
<em>DomainKeys Identified Mail</em>, is e-mail validation system for preventing e-mail
spoofing. <a href="https://support.google.com/mail/answer/180707?hl=en">Google recommends
setting up DKIM</a>; if we don&#8217;t, the e-mail messages that we forward to Gmail have
a higher probability of getting marked as spam.</p></div>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Sender_Rewriting_Scheme">SRS</a>, short for <em>Sender
Rewriting Scheme</em>, is a relatively new standard that e-mail forwarding servers
are recommended to adopt, and it also helps reduce the likelihood of our
forwarded e-mail messages getting marked as spam.</p></div>
<div class="paragraph"><p>Thus, while technically optional, it&#8217;s a good idea to configure our Postfix
server to support both these standards. See my follow-up tutorial on
<a href="/posts/setting-up-dkim-and-srs-in-postfix.html">Setting Up DKIM And SRS In
Postfix</a> for a detailed step-by-step guide.</p></div>
</div>
<div class="sect2">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph"><p>In this post, we have set up a Postfix e-mail server that accomplishes the
following:</p></div>
<div class="ulist"><ul>
<li>
<p>
E-mails sent to <code>john@example.com</code> is received by Postfix on
  <code>myserver.example.com</code> port 25, and forwarded to <code>john123@gmail.com</code>;
</p>
</li>
<li>
<p>
Gmail will let you select <code>john@example.com</code> as a "from" address when
  composing / replying to an e-mail, and will relay such e-mails through Postfix
  on <code>myserver.example.com</code> port 587 using a configured user name / password
  combination.
</p>
</li>
</ul></div>
<div class="paragraph"><p>I hope you found this guide useful, and if you have any thoughts / questions,
you&#8217;re more than welcome to leave a comment below. Cheers!</p></div>
</div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Nov 06, 2014
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="https://seasonofcode.com/tag/featured.html">Featured</a>,          <a href="https://seasonofcode.com/tag/misc.html">Misc</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="https://seasonofcode.com/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="https://seasonofcode.com/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="https://seasonofcode.com/posts/the-most-popular-fonts-on-the-web-a-study.html" rel="bookmark">
      The Most Popular Fonts On The Web: A Study
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2014-04-04T23:04:00-07:00">
          Apr 04, 2014
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="https://seasonofcode.com/tag/featured.html">Featured</a>,            <a href="https://seasonofcode.com/tag/misc.html">Misc</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="https://seasonofcode.com/posts/the-most-popular-fonts-on-the-web-a-study.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p><link rel="image_src"
href="https://docs.google.com/spreadsheets/d/1LxHdYqTqK7b9Subq2F23IHRrhEYoYm7xdVPQMZexaNc/embed/oimg?id=1LxHdYqTqK7b9Subq2F23IHRrhEYoYm7xdVPQMZexaNc&oid=65057078&zx=ey1naahah70j">
If you&#8217;ve ever worked on a web site, you already know that choosing the right
fonts is one of the most important aesthetic decisions in the design of a site.
But, like all aesthetic decisions, it is a highly subjective.</p></div>
<div class="paragraph"><p>I decided to try to bring a little bit of objectivity into the equation by
finding out, empirically, what fonts the most popular sites on the web are using
today.</p></div>
<div class="sect2">
<h3 id="_methodology">Methodology</h3>
<div class="paragraph"><p>I wrote a Python program that crawls the front page of the 100,000 most popular
web sites according to <a href="http://www.alexa.com/topsites">Alexa&#8217;s top sites list</a>.
It parses the HTML using
<a href="http://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a>, and parses all
in-line and linked CSS stylesheets using <a href="http://cthedot.de/cssutils/">cssutils</a>.
It then looks for <code>font</code> and <code>font-family</code> rules in the CSS rules, and stores
the normalized form of each font in those rules in order. The result is kept in
a <a href="https://sqlite.org">SQLite</a> database for analysis.</p></div>
<div class="paragraph"><p>This all sounds pretty straightforward, but in fact it took me two weeks to
build a crawler that doesn&#8217;t choke on all the crazy crap people throw at
browsers. I will write up some of the more interesting cases in a separate post.</p></div>
<div class="paragraph"><p>The final crawl success rate was about 96%. The size of all HTML and stylesheets
downloaded was about 30GB.</p></div>
</div>
<div class="sect2">
<h3 id="_the_most_popular_first_choice_fonts">The Most Popular First-Choice Fonts</h3>
<div class="paragraph"><p>First, let&#8217;s take a look at the first-choice/most preferred fonts, i.e., the
ones that appear first in <code>font-family</code> rules. These fonts most closely
represent the intention of the web site designers without compatibility
compromises.</p></div>
<div class="paragraph"><p>For each font, we calculate the number of distinct web sites that have at least
one CSS <code>font</code> or <code>font-family</code> rule that lists the font as the first choice.
This means that if a site has two rules, one listing Arial and another
listing Times, it will count towards both. Thus, the numbers add up to much
higher than the total number of sites.</p></div>
<div class="paragraph"><p>Without further ado, here&#8217;s the breakdown of the top fonts on the web:
<div align="center"><iframe
height=620
style="max-width: 610px; width: 100%"
src="//docs.google.com/spreadsheets/d/1LxHdYqTqK7b9Subq2F23IHRrhEYoYm7xdVPQMZexaNc/gviz/chartiframe?oid=65057078"
seamless frameborder=0 scrolling=yes></iframe></div>
(The chart is interactive - hover/click to see actual numbers.)</p></div>
<div class="paragraph"><p>A couple of observations:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>Sans-serif fonts dominate the web.</strong> The top 25 fonts list only includes 4
  serif fonts, compared to 16 sans-serif fonts. The most popular serif-font,
  Georgia, ranks #4 on the list with about 20% of sites.
</p>
</li>
<li>
<p>
<strong>Monospace fonts get no love.</strong> Most sites don&#8217;t bother
  specifying a custom monospace font; the most common monospace font
  specification just uses the browser default (12%). The most popular monospace
  font, Monaco, is featured on 7.2% of sites. Both of these are quite high, in
  fact, considering that we only crawl the front page of these sites.
</p>
</li>
<li>
<p>
<strong>The most popular fonts of each family:</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>Sans-serif:</strong> Arial (#1, 62%)
</p>
</li>
<li>
<p>
<strong>Serif:</strong> Georgia (#4, 20%)
</p>
</li>
<li>
<p>
<strong>Monospace:</strong> Monaco (#11, 7.2%)
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>Old Microsoft fonts still reign over the web.</strong> The top non-Microsoft font,
  Helvetica Neue, ranks #6 with an impressive 18% of top web sites.
</p>
</li>
<li>
<p>
<strong><a href="http://fortawesome.github.io/Font-Awesome/">Font Awesome</a> is awesome</strong>. About
  4.6% of the top 100K sites already use it for universal icons.
</p>
</li>
<li>
<p>
<strong>The Chinese web is on the rise.</strong> 3 out of the top 25 fonts are Chinese fonts,
  compared to 21 Latin fonts (and 1 symbol font). No other scripts made their
  way into the list.
</p>
</li>
</ul></div>
<div class="sect3">
<h4 id="_what_if_we_considered_8230">What If We Considered&#8230;</h4>
<div class="ulist"><ul>
<li>
<p>
<strong>Fonts in all positions</strong>: (<a href="https://docs.google.com/spreadsheets/d/1LxHdYqTqK7b9Subq2F23IHRrhEYoYm7xdVPQMZexaNc/gviz/chartiframe?oid=940843634">graph</a>) not much difference.
</p>
</li>
<li>
<p>
<strong>The top 1,000 web sites only</strong>: (<a href="https://docs.google.com/spreadsheets/d/1LxHdYqTqK7b9Subq2F23IHRrhEYoYm7xdVPQMZexaNc/gviz/chartiframe?oid=1208179553">graph</a>) even more Arial (#1, 74%).
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_the_most_popular_heading_fonts">The Most Popular Heading Fonts</h3>
<div class="paragraph"><p>Next, let&#8217;s look at first-choice fonts used in headings or titles.</p></div>
<div class="paragraph"><p>I used a really crude metric to determine whether a CSS rule matches a heading:
whether the CSS selector is for an <code>H1</code>&#8230;<code>H6</code> tag or contains the strings
"heading" or "title". While this finds only a subset of actual headings, it is
not a bad approximation as it matches rules on about 58% of the top 100,000
web sites.</p></div>
<div class="paragraph"><p>Let&#8217;s start with the graph:
<div align="center"><iframe
height=620
style="max-width: 610px; width: 100%"
src="//docs.google.com/spreadsheets/d/1LxHdYqTqK7b9Subq2F23IHRrhEYoYm7xdVPQMZexaNc/gviz/chartiframe?oid=1659247262"
seamless frameborder=0 scrolling=yes></iframe></div>
Observations:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>Header fonts are more diverse.</strong> While Microsoft fonts still reign supreme, a
  number or more exotic fonts are also on the list. In terms of distribution,
  there&#8217;s a much longer tail. It may be a sign that designers pay a lot
  more attention to fonts used in headings.
</p>
</li>
<li>
<p>
<strong>Serif fonts are more popular in headings than elsewhere.</strong> While Arial still
  claims to top spot with 27.31% of sites, the top serif font, Georgia, rises to
  2nd place with 9% of sites.
</p>
</li>
<li>
<p>
<strong>No monospace fonts in headings.</strong> Not surprising.
</p>
</li>
<li>
<p>
Among Chinese fonts, <strong>宋体 is more commonly used for body text, while 雅黑 (or
  Yahei) is more commonly used for heading text.</strong>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_concluding_thoughts">Concluding Thoughts</h3>
<div class="paragraph"><p>Arial and friends are the <a href="http://screenfont.ca/fonts/today/interim/">most</a>
<a href="http://pxlnv.com/blog/guaahhhhhhh-come-on/">hated</a>
<a href="http://www.prepressure.com/fonts/interesting/most-hated">fonts</a>
<a href="http://enjoytherandom.com/hipster-hitler-hates-arial/">ever</a>. Quoting
<a href="http://www.marksimonson.com/notebook/view/the-scourge-of-arial">The Scourge of
Arial</a>:</p></div>
<div class="quoteblock">
<div class="content">Despite its pervasiveness, a professional designer would rarely - at least for
the moment - specify Arial.</div>
<div class="attribution">
</div></div>
<div class="paragraph"><p>And yet, Arial is still the default font on the vast majority of sites on
the web, followed closely by its friends. Why?</p></div>
<div class="paragraph"><p>Quoting <a href="http://www.64notes.com/design/stop-helvetica-arial/">Stop Using Arial &amp;
Helvetica</a>:</p></div>
<div class="quoteblock">
<div class="content">Some people actually have a reason to use them but most use it mindlessly - just
because everyone else does. Often, no thought is given to design of the site,
let alone typography.</div>
<div class="attribution">
</div></div>
<div class="paragraph"><p>This is pretty sad. Paraphrasing
<a href="http://www.dtelepathy.com/blog/graveyard/stop-using-lame-fonts">Stop Using Lame
Fonts</a>, a good font stack has the potential to really make a site design shine,
and it&#8217;s a shame web designers aren&#8217;t exploiting this opportunity.</p></div>
</div>
<div class="sect2">
<h3 id="_caveats">Caveats</h3>
<div class="paragraph"><p>There are a couple of caveats with this dataset.</p></div>
<div class="paragraph"><p>First, I am only surveying the landing page of each site. For many sites,
notably those whose main interface is hidden behind a login (Facebook, Evernote,
etc.), we may not be finding the styles that matter most to users. However, I
figured since it would be pretty poor design to build a landing page that is
aesthetically inconsistent with the rest of the site, it is not very likely that
the font selection on the landing page would be too different from the fonts
used elsewhere on the site. Of course, without creating fake accounts on these sites,
we have no way to verify.</p></div>
<div class="paragraph"><p>The numbers are not weighted by prominence on the web pages. One could argue
that the font of the main body text on a page should carry more weight than that
of the tiny disclaimer text at the bottom which no one reads. It would be tricky
to determine what the right weight function is though.</p></div>
<div class="paragraph"><p>The numbers are not weighted by the prominence of the web sites. For example, we
could make it so that Google&#8217;s use of Arial would get more weight than some
random obscure site&#8217;s use of Arial, as Google&#8217;s choice impacts many more users
and was probably the result of deliberation by a team of expert designers.
Again, it&#8217;s not entirely obvious how the weights should be assigned.</p></div>
<div class="paragraph"><p>I am only looking at CSS rules in <code>&lt;style&gt;</code> tags or linked stylesheets. That
means I am ignoring <code>style="&#8230;"</code> attributes in tags, <code>&lt;font&gt;</code> elements, or
dynamically assigned fonts (i.e., through JavaScript). I would be surprised if
this turns out to be a big loss though.</p></div>
</div>
<div class="sect2">
<h3 id="_next_steps">Next Steps</h3>
<div class="paragraph"><p>I can think of quite a few other useful questions one might find the answer to
from this dataset:</p></div>
<div class="ulist"><ul>
<li>
<p>
What are the most common font pairings?
</p>
</li>
<li>
<p>
What are the popular choices for heading fonts, given that I&#8217;ve chosen font X
  as my body text font?
</p>
</li>
<li>
<p>
What are the most common fonts on news sites/forums/productivity web
  apps/social media sites?
</p>
</li>
<li>
<p>
Is there any correlation between font choice and site popularity?
</p>
</li>
</ul></div>
<div class="paragraph"><p>What do you think?</p></div>
<div class="paragraph"><p>Please feel free to <a href="https://www.mediafire.com/?xqrk731716v078l">download</a> the top
100 first-choice fonts as a CSV file.</p></div>
</div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Apr 04, 2014
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="https://seasonofcode.com/tag/featured.html">Featured</a>,          <a href="https://seasonofcode.com/tag/misc.html">Misc</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="https://seasonofcode.com/posts/the-most-popular-fonts-on-the-web-a-study.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="https://seasonofcode.com/posts/the-most-popular-fonts-on-the-web-a-study.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="https://seasonofcode.com/posts/connectbot-on-the-asus-eee-pad-slider-sl101.html" rel="bookmark">
      ConnectBot on the Asus Eee Pad Slider (SL101)
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2011-10-18T03:45:15-07:00">
          Oct 18, 2011
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="https://seasonofcode.com/tag/misc.html">Misc</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="https://seasonofcode.com/posts/connectbot-on-the-asus-eee-pad-slider-sl101.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>I recently acquired an <a href="http://www.asus.com/Eee/Eee_Pad/Eee_Pad_Slider_SL101">Eee Pad Slider</a>, a truly groundbreaking Android tablet running Honeycomb 3.2. Its unique sliding keyboard allows it to transcend the conventional definition of tablets as content consumption devices while preserving to perfection the intimacy of touch interface interaction. To be honest, however, up until last week I had always seen tablets as these flashy toys whose only purpose in life was to satisfy the vanity of a few mindless and unfortunately privileged gadget fanboys. But I fell in love with the Eee Pad Slider at first sight. This was a device that perfectly bridged that gap between my laptop and my smartphone; this was a device that was as immediately accessible, friendly, and visually appealing as my smartphone for casual use, but as pragmatic and dependable as my Thinkpad T400 when I need to get down and serious and reply to that one email or fix that one bug in my code. It&#8217;s simply the most versatile mobile device between a phone and a full blown PC.</p></div>
<div class="paragraph"><p>Before I am dismissed as a crazed and dangerous fanatic, however, I should admit that I fully understand the fact that the Slider is not the best tablet for everyone. The Slider is probably twice as thick as the iPad or the Samsung Galaxy Tab and about the same price as either one of the two. Its keys are much less comfortable than those on your typical ultraportable laptop. It is also brown, a color I would not place very high on my list of good colors for electronic devices. It is probably not the best consumer lifestyle gadget you can find on the market, nor the most suitable for mobile office computing. But it is a very innovative and intelligent cross of the two worlds, and that happened to be exactly that one device I could not find in the hugely diverse and volatile market of mobile devices of today.</p></div>
<div class="paragraph"><p>Back, then, to the real deal. I am a computer geek and I cannot live very well without SSH. On Android the SSH client that I (and it looks like everyone else) have been using is ConnectBot. So among the first apps I installed on my brand new Eee Pad Slider was ConnectBot; <em>finally</em> I thought, there was a mobile keyboard that had real control, shift, and alt keys that I could use. I was very surprised, therefore, when I realized that none of them worked. Given that the Slider has only been released for a month, forum threads and other helpful resources are nonexistent. I dug up <a href="http://code.google.com/p/connectbot/wiki/KeyboardShortcuts"> the discussion on this document</a> and found <a href="https://github.com/lorantkurthy/connectbot">Lorant Kurthy&#8217;s fork of ConnectBot on GitHub</a> that fixed the same issues for the Eee Pad Transformer. I cloned his repository and, with a one-line change in the source code, enabled his fix for the Slider as well. So there we go - here is <a href="/assets/files/ConnectBot-release.apk">my version of ConnectBot with fixes for the Eee Pad Transformer and Eee Pad Slider hardware keyboards</a>. As far as I can tell it works fine; in fact, I am typing this post on the Eee Pad Slider using Vim in an SSH session to my laptop via my version of ConnectBot. All the credit goes to Lorant Kurthy though.</p></div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Oct 18, 2011
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="https://seasonofcode.com/tag/misc.html">Misc</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="https://seasonofcode.com/posts/connectbot-on-the-asus-eee-pad-slider-sl101.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="https://seasonofcode.com/posts/connectbot-on-the-asus-eee-pad-slider-sl101.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="https://seasonofcode.com/posts/qemu-arm-boot-tags.html" rel="bookmark">
      QEMU ARM boot tags
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2011-05-18T16:22:35-07:00">
          May 18, 2011
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="https://seasonofcode.com/tag/misc.html">Misc</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="https://seasonofcode.com/posts/qemu-arm-boot-tags.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>I had to fight against a "feature" in QEMU today as I was screwing around. Normally when QEMU ARM boots a Linux kernel it sets up a tag list with all sorts of good information like available memory regions as explained <a href="http://www.arm.linux.org.uk/developer/booting.php">here</a>. This is the Linux&#8217;s standard for ARM and any ARM bootloader that loads Linux must do this. However, when I was booting my custom kernel with <code>qemu-system-arm</code> I discovered that R1 and R2 were empty upon boot using the switch <code>-monitor stdio</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>QEMU 0.13.0 monitor - type 'help' for more information
(qemu) info registers
R00=00000000 R01=00000000 R02=00000000 R03=00000000
R04=00000000 R05=00000000 R06=00000000 R07=00000000
R08=00000000 R09=00000000 R10=00000000 R11=00000000
R12=00000000 R13=00000000 R14=00000000 R15=00000020
PSR=400001d3 -Z-- A svc32</code></pre>
</div></div>
<div class="paragraph"><p>This meant of course that the kernel refused to load at all. In addition, nowhere in memory could the tag list be found, as I saw with a quick assembly search through memory space.</p></div>
<div class="paragraph"><p>So I downloaded the QEMU source code and found the relevant code in <code>hw/arm_boot.c</code>. The code there is pretty straightforward, and it turns out that QEMU ARM will only install a tag list if it determines kernel to be Linux. This is fine in itself, but the way it figures out if a given kernel is Linux is really stupid - as a comment in the file reads:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cm">/* Assume that raw images are linux kernels, and ELF images are not.  */</span>
</pre></div></div></div>
<div class="paragraph"><p>This is really silly as one just <code>objcopy -O binary</code> any kernel into a raw image anyway. So I just set the initial assignment to <code>is_linux = 1;</code> in <code>arm_load_kernel(&#8230;)</code>, compiled the ARM version, and copied it into my <code>/usr/bin</code>. Sigh.</p></div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        May 18, 2011
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="https://seasonofcode.com/tag/misc.html">Misc</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="https://seasonofcode.com/posts/qemu-arm-boot-tags.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="https://seasonofcode.com/posts/qemu-arm-boot-tags.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
<div>
  <ul class="pager">
    <!--- <li class="previous disabled"><a>&larr; Previous</a></li> -->
    <li class="next"><a href="https://seasonofcode.com/tag/misc2.html">Next &rarr;</a></li>
  </ul>
</div>
    </section>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p class="footer-text text-muted">&copy; 2015 Chuan Ji</p>
      </div>
    </footer>
    <script src="https://seasonofcode.com/theme/jquery.min.js"></script>
    <script src="https://seasonofcode.com/theme/bootstrap/js/bootstrap.min.js"></script>

<script type="text/javascript">
  var disqus_shortname = 'cjix';
  (function () {
      var s = document.createElement('script');
      s.async = true;
      s.type = 'text/javascript';
      s.src = '//' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] ||
       document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

  </body>
</html>
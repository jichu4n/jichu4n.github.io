<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <title>Season of Code</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="shortcut icon" href="http://seasonofcode.com/assets/favicon.ico" />
      <link href="http://seasonofcode.com/theme/asciidoc.min.css?0e298cf5" rel="stylesheet" />
    <link href="http://seasonofcode.com/theme/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="http://seasonofcode.com/theme/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
      <link href="http://seasonofcode.com/theme/style.min.css?918c51a9" rel="stylesheet" />
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="http://seasonofcode.com/theme/html5shiv.min.js"></script>
    <script src="http://seasonofcode.com/theme/respond.min.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="http://seasonofcode.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Season of Code Full Atom Feed" />

    <meta name="google-site-verification" content="g_MrQjKfWWKOccQYg--leY8NlSev0om0sy2vrBLYoZU">
    <meta name="google-site-verification" content="_r0m7LYlH2JjDgeTysX9Fv0OzQG1xUEAU6x2uSr9nH8">

    <meta name="msvalidate.01" content="F10D3C66876F50983761BFE53E2B943A4">

  <meta name="robots" content="noindex, follow">
  </head>
  <body id="index" class="archive">
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <nav id="header" class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <i class="fa fa-bars fa-lg"></i>
          </button>
          <a class="navbar-brand" href="http://seasonofcode.com">
            season <span class="of">of</span> code
          </a>
        </div>
        <div class="collapse navbar-collapse navbar-right">
          <ul class="nav navbar-nav">
            <li>
              <a href="http://seasonofcode.com/tag/featured.html">Featured</a>
            </li>
            <li id="header-tags-dropdown" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                role="button">Tags <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu">
                  <li><a href="http://seasonofcode.com/tag/android.html">Android</a></li>
                  <li><a href="http://seasonofcode.com/tag/c.html">C++</a></li>
                  <li><a href="http://seasonofcode.com/tag/featured.html">Featured</a></li>
                  <li><a href="http://seasonofcode.com/tag/linux.html">Linux</a></li>
                  <li><a href="http://seasonofcode.com/tag/misc.html">Misc</a></li>
                  <li><a href="http://seasonofcode.com/tag/projects.html">Projects</a></li>
                  <li><a href="http://seasonofcode.com/tag/python.html">Python</a></li>
                  <li><a href="http://seasonofcode.com/tag/window-manager.html">Window Manager</a></li>
              </ul>
            </li>
            <li>
              <a href="http://seasonofcode.com/archives.html">Archives</a>
            </li>
            <li><a href="http://seasonofcode.com/pages/about.html">About</a></li>
          </ul>
        </div>
        <!-- /.navbar-collapse -->
      </div>
    </nav>
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-8 col-md-offset-2">
    <section id="content" class="content">
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="http://seasonofcode.com/posts/flashing-a-sprint-nexus-s-4g-to-verizon.html" rel="bookmark">
      Flashing a Sprint Nexus S 4G to Verizon
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2015-11-11T18:51:00-08:00">
          Nov 11, 2015
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="http://seasonofcode.com/tag/featured.html">Featured</a>,            <a href="http://seasonofcode.com/tag/android.html">Android</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="http://seasonofcode.com/posts/flashing-a-sprint-nexus-s-4g-to-verizon.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>I originally wrote the following post in July 2012 to document how to fully
flash a Nexus S 4G from Sprint to Verizon Wireless, but never got to publishing
it. I have long since switched away from Verizon Wireless and no longer own any
of the phones mentioned, and decided to publish it for what it&#8217;s worth.</p></div>
<div class="paragraph"><p>If you&#8217;re interested in the high-level view of how CDMA phones are programmed,
check out my previous article
<a href="/posts/carrier-programming-on-cdma-android-phones.html">Carrier Programming
on CDMA Android Phones</a>.</p></div>
<div class="sect2">
<h3 id="_introduction">Introduction</h3>
<div class="paragraph"><p>This is a guide for flashing a Sprint Samsung Nexus S 4G to a standard Verizon
monthly plan, and voice, texting and 3G data will all be fully functional. This
method will likely also work on many other phones, especially Samsung ones, and
should theoretically work just file on any ROM as well.</p></div>
<div class="paragraph"><p>Note that this procedure entails ESN cloning, which may be illegal in your
region. Please make sure you have an understanding of all applicable laws before
proceeding. The author of this guide cannot be held responsible for any legal
infractions that may ensue. Finally, you are solely responsible for any
consequences of your actions as a result of following this guide. While I
believe it to be quite safe, I cannot guarantee you that this process will not
brick your devices or start a zombie apocalypse.</p></div>
</div>
<div class="sect2">
<h3 id="_requirements_and_setup">Requirements and Setup</h3>
<div class="paragraph"><p>We will need the following before starting:</p></div>
<div class="ulist"><ul>
<li>
<p>
A currently active Verizon Wireless Android phone and plan. Please beware that
  not all phones will work; many phones do not allow us to extract all the
  information we need for this process. For instance, my Motorola Droid 3 did not
  work, and I had to purchase and activate an HTC Incredible for this. This phone
  will be our donor phone.
</p>
</li>
<li>
<p>
A rooted Samsung Nexus 4G.
</p>
</li>
<li>
<p>
A computer running a recent version of Windows, with at least 2 USB ports.
</p>
</li>
<li>
<p>
2 MicroUSB cables.
</p>
</li>
</ul></div>
<div class="paragraph"><p>In addition, we need the following software:</p></div>
<div class="ulist"><ul>
<li>
<p>
USB diagnostic drivers for your donor phone. These vary by manufacturer and
  their configuration may be quite complex; search online for how to set up
  yours.  For HTC phones, download and install HTC Sync from HTC’s website
  (archived <a href="http://www.mediafire.com/?65l9idwgbzq5avb">here</a>).
</p>
</li>
<li>
<p>
USB diagnostic drivers for the Nexus S 4G. The easiest way is to download and
  install PdaNet (archived
  <a href="http://www.mediafire.com/?jjdv8g7ie82kxdx">here</a>). We don’t actually need
  the functionality of PdaNet, but it happens to bundle the drivers we need.
  Select Samsung when prompted for the manufacturer of our phone.
</p>
</li>
<li>
<p>
QPST and QXDM (archived <a href="http://www.mediafire.com/?ojco4qzf4r688k6">here</a>).
  These are internal Qualcomm tools; we will use them to clone the MEID of the
  donor phone.
</p>
</li>
<li>
<p>
DFS (archived <a href="http://www.mediafire.com/?wp7hc8ny854pqrz">here</a>). This is
  a third-party tool for working with CDMA phones. The demo version will
  suffice.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_step_1_preparation">Step 1: Preparation</h3>
<div class="paragraph"><p>First, make sure the donor phone is fully activated and that calls, text and
data are all fully functional.</p></div>
<div class="paragraph"><p>Now, find the HEX MEID of the donor phone. On the HTC Incredible, this can be
found under <em>Settings &#8594; About Phone &#8594; Phone Identity</em>. On most Android phones,
this is under <em>Settings &#8594; About Phone &#8594; Status</em>. It is also usually printed on a
label underneath the phone battery. This should be 14 digits and usually begins
with <code>A00000</code>.</p></div>
<div class="paragraph"><p>Now put the donor phone in airplane mode.</p></div>
<div class="paragraph"><p>We will next connect both phones to the computer in diagnostic mode.</p></div>
<div class="ulist"><ul>
<li>
<p>
On the Nexus S 4G, dial <code>*#*#8778#*#*</code>, then select <em>MODEM</em> under <em>USB</em>.
  Connect the Nexus S 4G to the computer. If drivers were installed correctly,
  you should now see a <em>SAMSUNG Mobile Modem Diagnostic Serial Port (WDM)</em> under
  <em>Ports (COM &amp; LPT)</em> in Windows’s Device Manager. Note down the port number of
  the Nexus S 4G; we will assume COM4 for convenience.
</p>
</li>
<li>
<p>
On the HTC Incredible, dial <code>##3424#</code>, hit <em>Call</em>,
  connect it to the computer, then follow the instructions in
  <a href="http://forum.xda-developers.com/showthread.php?t=1619314">this thread</a>
  with Device Manager. If everything goes well you should now see a <em>HTC
  Diagnostic Interface</em> under <em>Ports (COM &amp; LPT)</em> in Device Manager. Note down
  the port number of the HTC Incredible; we will assume COM11 for convenience.
</p>
</li>
</ul></div>
<div class="paragraph"><p>After confirming that both phones show up under <em>Ports (COM &amp; LPT)</em>, run QPST
Configuration and hit <em>Add New Port&#8230;</em>. You should see both phones on the left.
Select one and hit OK. Then repeat for the other phone.</p></div>
</div>
<div class="sect2">
<h3 id="_step_2_cloning">Step 2: Cloning</h3>
<div class="paragraph"><p>We will now clone the MEID of the donor phone onto the target phone. Open QXDM
Professional. Select <em>Options &#8594; Communications&#8230;</em>. For <em>Target Port</em>, select the
port corresponding to the Nexus S 4G, say COM4, and hit <em>OK</em>. Then in the text box
labeled <em>Command</em>, type the following:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Password 01F2030F5F678FF9</code></pre>
</div></div>
<div class="paragraph"><p>Hit <em>Enter</em>. You should see <code>Password Result = Correct</code> at the bottom of the
<em>Command Output</em> window.</p></div>
<div class="paragraph"><p>Now in the <em>Command</em> text box, type the following, replacing <code>&lt;MEID&gt;</code> by the hex
MEID of the <strong>donor</strong> phone:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>RequestNVItemWrite meid 0x&lt;MEID&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Hit <em>Enter</em>. You should see it repeat back the MEID to you. Type
<code>RequestNVItemRead meid</code> followed by <em>Enter</em> to make sure the write happened.</p></div>
<div class="paragraph"><p>Close QXDM Professional and reboot the Nexus S 4G. Rebooting the target phone
after writing a new MEID is essential! If prompted, do NOT go through the
activation process on the Nexus S 4G. Just select <em>Skip</em> when possible.</p></div>
</div>
<div class="sect2">
<h3 id="_step_3_reset_spc">Step 3: Reset SPC</h3>
<div class="paragraph"><p>In order to program the Nexus S 4G, we need to obtain or reset the SPC code
(also known as the MSL) of the phones. If you already know the SPC code for your
phones and would rather not reset the SPC code, you can skip this step.</p></div>
<div class="paragraph"><p>Open QXDM Professional again. Go through <em>Options &#8594;
Communications</em> and make sure the <em>Target Port</em> is still COM4. Hit <em>OK</em>. In the
command text box, type the following two lines, each followed by an <em>Enter</em>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Password 01F2030F5F678FF9
RequestNVItemWrite sec_code 000000</code></pre>
</div></div>
<div class="paragraph"><p>If this is successful, the SPC on the Nexus S 4G will have been reset to
<code>000000</code>. Repeat for the donor phone (in our example, on COM11).</p></div>
<div class="paragraph"><p>Close QXDM Professional after done. All QPST / QXDM programs must be closed
before proceeding, or DFS will complain.</p></div>
</div>
<div class="sect2">
<h3 id="_step_4_programming_cdma_chipset">Step 4: Programming CDMA Chipset</h3>
<div class="paragraph"><p>Launch DFS. Click <em>Ports</em> on the top left. In the dialog box, double-click on
each port representing our phones, in our case, COM4 and COM11, and close the
dialog box. Now make sure the <em>SPC</em> text box above reads <code>000000</code> (or if you chose
not to reset the SPC, whatever your SPC is). Type <code>01F2030F5F678FF9</code> into the
<em>Pwd</em> text box.</p></div>
<div class="sect3">
<h4 id="_step_4_a_basic_cdma_settings">Step 4.a: Basic CDMA settings</h4>
<div class="paragraph"><p>Let&#8217;s now copy basic CDMA settings from the donor phone to the
target phone. In the drop-down menu next to <em>Ports</em>, select the donor phone
(COM11). Switch to the <em>Programming</em> tab and the <em>NAM</em> tab under it. Click the
<em>SPC</em> and <em>Pwd</em> buttons to send the SPC and NV password to the phone to unlock
it. Then hit <em>Read</em> beneath <em>Network identification</em>. The text fields below
should be populated by information from the donor phone. Now select COM4 in the
drop-down menu next to <em>Ports</em>, click <em>SPC</em> and <em>Pwd</em>, then click <em>Write</em>
beneath <em>Network identification</em>.</p></div>
</div>
<div class="sect3">
<h4 id="_step_4_b_prl">Step 4.b: PRL</h4>
<div class="paragraph"><p>Now, let&#8217;s copy over the PRL (or <em>Preferred Roaming List</em> - essentially a
database of tower locations). Again, select COM11 under <em>Ports</em> and click <em>Read</em>
under <em>PRL</em> towards the right. Then select COM4 under <em>Ports</em> and click <em>Write</em>
under <em>PRL</em>.</p></div>
</div>
<div class="sect3">
<h4 id="_step_4_c_2g_data_settings">Step 4.c: 2G Data settings</h4>
<div class="paragraph"><p>Now go to the next tab, <em>Data</em>. Select COM11 and hit <em>Read</em>. Switch to COM4 and
hit <em>Write</em>.  If you observe errors in the log window in the bottom, and / or no
information shows up in the <em>Pwd</em> boxes under <em>PPP</em> and <em>HDR AN Long</em>, your
donor phone doesn&#8217;t support the extraction of some data passwords, and you
will have to try a different donor phone.</p></div>
</div>
<div class="sect3">
<h4 id="_step_4_c_3g_data_settings">Step 4.c: 3G Data settings</h4>
<div class="paragraph"><p>We do the same with <em>Mobile IP</em>. Select COM11 and hit <em>Read</em>. Switch to COM4 and
hit <em>Write</em>. Then hit <em>Write current profile settings</em>. Again, if you encounter
errors, or no information shows up under <em>AAA Shared secret</em> and <em>HA Shared
Secret</em>, you will have to try a different donor phone.</p></div>
<div class="paragraph"><p>Finally, we need to copy over a file containing a secret key used to establish a
3G connection. Go to the <em>EFS</em> tab towards the top.  Select COM11 and hit <em>Read
EFS</em>.  Click the "<em>+</em>" sign of the root folder on the left and then the "<em>+</em>"
sign next to the <code>DMU</code> folder and you should see a file called <code>10.key</code>.
Right-click on this file and hit <em>Save&#8230;</em>.  Save this file somewhere on your
hard drive. Now switch to COM4 and hit <em>Read EFS</em> again.  Select the root folder
on the left, type <code>/DMU</code> under <em>Path (57 max)</em> on the right and hit <em>Add Item</em>
to create a folder named <code>DMU</code> on the Nexus S 4G. Then select <code>DMU</code> on the left,
click on the check box named <em>I want to add file from PC</em>, and select the
<code>10.key</code> file we just saved. Then hit <em>Add Item</em> to upload the <code>10.key</code> file to
<code>/DMU/10.key</code>.</p></div>
<div class="paragraph"><p>The programming is now done. Close DFS, select <em>OK</em> and <em>OK</em> again when prompted
whether to send a <em>mode reset</em> to the phone. The Nexus S 4G will now reboot.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_step_5_programming_android">Step 5: Programming Android</h3>
<div class="paragraph"><p>We will now modify some Android system files to Verizon settings. This step will
need to be repeated whenever you flash a new ROM on the Nexus S 4G in the
future.</p></div>
<div class="sect3">
<h4 id="_1_click_programming_app">1-click programming app</h4>
<div class="paragraph"><p>I have built a 1-click Android application that automates this step; you can
find it <a href="http://www.mediafire.com/?m796blddz3g8ifd">here</a>. It requires root
as it will need to modify system files. Install the application and click the
button in the middle. When the process finishes, you will be prompted to reboot.
Simply reboot your phone and you’re all set; you may uninstall the app, or you
could keep it around for when you update to a new ROM.</p></div>
<div class="paragraph"><p>If the 1-click app does not work for you, or if you want more control over what
it does, follow the steps below. You do not need to do any of the following if
you already used the app above.</p></div>
</div>
<div class="sect3">
<h4 id="_step_5_a_fix_voice_calling">Step 5.a: Fix voice calling</h4>
<div class="paragraph"><p>This is required to enable calls on Verizon.
On the Nexus S 4G, connect to WiFi and install ES File Explorer from the Play
Store. Then go to <em>Menu &#8594; Settings</em> and check <em>Up to Root</em>, <em>Root Explorer</em>, and
<em>Mount File System</em>. Allow it to use superuser privileges if asked. Then
navigate to <code>/system</code> and open <code>build.prop</code> with <em>ES Note Editor</em>. Find the
following two lines:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>ro.cdma.home.operator.numeric=310120
ro.cdma.home.operator.alpha=Sprint</code></pre>
</div></div>
<div class="paragraph"><p>Change them to read:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>ro.cdma.home.operator.numeric=310004
ro.cdma.home.operator.alpha=Verizon</code></pre>
</div></div>
<div class="paragraph"><p>Then add a line below (or anywhere in the file) that says:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>ro.cdma.homesystem=64,65,76,77,78,79,80,81,82,83</code></pre>
</div></div>
<div class="paragraph"><p>Hit <em>Menu &#8594; Save</em> and then <em>Back</em> to exit.</p></div>
</div>
<div class="sect3">
<h4 id="_step_5_b_fix_roaming">Step 5.b: Fix roaming</h4>
<div class="paragraph"><p>This step tells Android to treat the Verizon network as the home network. It
sets the roaming status to "Not roaming", removes the triangular roaming
indicator in the status bar and changes the displayed name of the current
network to "Verizon Wireless".</p></div>
<div class="paragraph"><p>Now navigate to <code>/system/framework</code> and copy <code>framework-res.apk</code> onto your
computer - you can use adb or email it to yourself or whatever (you have to copy
it to the internal SD card before you can email it though). Once on the
computer, rename it <code>framework-res.zip</code> (yes, an APK is just a zip archive) and
use your favorite program to replace the file <code>res/xml/eri.xml</code> inside it with
the one at <a href="http://www.mediafire.com/?jdsigtxi4gvp6ks">this link</a>. Now rename
it back to <code>framework-res.apk</code>, copy it back
onto the Nexus S 4G (using adb or whatever) and use ES File Explorer to
overwrite the existing <code>/system/framework/framework-res.apk</code> with it.</p></div>
</div>
<div class="sect3">
<h4 id="_step_5_c_add_verizon_apns">Step 5.c: Add Verizon APNs</h4>
<div class="paragraph"><p>This last step sets up Verizon APNs that enable web and MMS. Use ES File
Explorer or any other tool to replace <code>/system/etc/apns-conf.xml</code> with the one
at <a href="http://www.mediafire.com/?g0vd7nfs47ksujz">this link</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_step_6_reboot_amp_profit">Step 6: Reboot &amp; PROFIT</h3>
<div class="paragraph"><p>The Nexus S 4G should now be a fully functional Verizon Wireless phone. If you
are curious about what each of the steps means, you&#8217;re welcome to check out my
previous article
<a href="/posts/carrier-programming-on-cdma-android-phones.html">Carrier Programming
on CDMA Android Phones</a> for a high-level view of how CDMA phones are programmed.</p></div>
<div class="paragraph"><p>While your mileage may vary, I hope the above information have been of help.
Since I no longer use Verizon Wireless and no longer own any of the phones
mentioned above, please take all this information with a grain of salt.</p></div>
<div class="paragraph"><p>Good luck, and happy hacking!</p></div>
</div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Nov 11, 2015
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="http://seasonofcode.com/tag/featured.html">Featured</a>,          <a href="http://seasonofcode.com/tag/android.html">Android</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="http://seasonofcode.com/posts/flashing-a-sprint-nexus-s-4g-to-verizon.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="http://seasonofcode.com/posts/flashing-a-sprint-nexus-s-4g-to-verizon.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="http://seasonofcode.com/posts/setting-up-dkim-and-srs-in-postfix.html" rel="bookmark">
      Setting Up DKIM And SRS In Postfix
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2014-12-09T17:25:00-08:00">
          Dec 09, 2014
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="http://seasonofcode.com/tag/misc.html">Misc</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="http://seasonofcode.com/posts/setting-up-dkim-and-srs-in-postfix.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>In my previous post
<a href="/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html"><em>Custom
Domain E-mails With Postfix And Gmail: The Missing Tutorial</em></a>, we set up a
Postfix mail server on a custom domain that integrates seamlessly with Gmail.</p></div>
<div class="paragraph"><p>However, the tutorial skipped two important security standards that will help
prevent e-mails routed through our server from being marked as spam:
<a href="http://en.wikipedia.org/wiki/DomainKeys_Identified_Mail">DKIM</a> and
<a href="http://en.wikipedia.org/wiki/Sender_Rewriting_Scheme">SRS</a>. This article will
show you how to add support for DKIM and SRS to a Postfix server.</p></div>
<div class="paragraph"><p>Similar to the
<a href="/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html">previous
tutorial</a>, we will assume a Ubuntu server in our examples.</p></div>
<div class="sect2">
<h3 id="_step_1_dkim">Step 1: DKIM</h3>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/DomainKeys_Identified_Mail">DKIM</a>, short for
<em>DomainKeys Identified Mail</em>, is a mechanism for</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
A sender e-mail program to sign an outgoing e-mail message, and
</p>
</li>
<li>
<p>
A recipient e-mail program to verify said signature.
</p>
</li>
</ol></div>
<div class="paragraph"><p>More concretely, let&#8217;s say Gmail receives an e-mail message from
<code>myserver.example.com</code>. DKIM allows Gmail to verify that the e-mail was indeed
sent by the designated e-mail server program on <code>myserver.example.com</code>, and not
by, say, a virus running on <code>myserver.example.com</code> or a malicious user who
happens to have access to <code>myserver.example.com</code>.</p></div>
<div class="paragraph"><p>We will use <a href="http://www.opendkim.org/">OpenDKIM</a> for this tutorial. To install
OpenDKIM on Ubuntu:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo apt-get install opendkim opendkim-tools
</pre></div></div></div>
<div class="sect3">
<h4 id="_code_etc_opendkim_conf_code"><code>/etc/opendkim.conf</code></h4>
<div class="paragraph"><p>Edit <code>/etc/opendkim.conf</code> to match the following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># OpenDKIM config.</span>

<span class="c"># Log to syslog</span>
Syslog                  yes
SyslogSuccess           yes
LogWhy                  yes
<span class="c"># Required to use local socket with MTAs that access the socket as a non-</span>
<span class="c"># privileged user (e.g. Postfix)</span>
UMask                   002

Mode                    sv
PidFile                 /var/run/opendkim/opendkim.pid
UserID                  opendkim:opendkim
Socket                  inet:12301@localhost

Canonicalization        relaxed/simple
SignatureAlgorithm      rsa-sha256

<span class="c"># Sign for example.com with key in /etc/opendkim.d/mail.private using</span>
<span class="c"># selector &#39;mail&#39; (e.g. mail._domainkey.example.com)</span>
Domain                  example.com
KeyFile                 /etc/opendkim.d/mail.private
Selector                mail

ExternalIgnoreList      refile:/etc/opendkim.d/TrustedHosts
InternalHosts           refile:/etc/opendkim.d/TrustedHosts
</pre></div></div></div>
<div class="paragraph"><p>You can check out a detailed explanation for the meaning of each option with <code>man
opendkim.conf</code>.</p></div>
</div>
<div class="sect3">
<h4 id="_code_etc_opendkim_d_trustedhosts_code"><code>/etc/opendkim.d/TrustedHosts</code></h4>
<div class="paragraph"><p>Create the directory <code>/etc/opendkim.d</code> and put the following in
<code>/etc/opendkim.d/TrustedHosts</code>. This instructs the OpenDKIM server to sign
e-mails delivered by any server matching these expressions (such as
<code>myserver_2.example.com</code>).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>127.0.0.1
localhost
192.168.0.1/24

*.example.com
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_dkim_keys">DKIM keys</h4>
<div class="paragraph"><p>Now, let&#8217;s generate our DKIM signing keys:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> /etc/opendkim.d
<span class="nv">$ </span>sudo opendkim-genkey -s mail -d example.com
</pre></div></div></div>
<div class="paragraph"><p>This will produce two files in <code>/etc/opendkim.d</code>: our private key,
<code>mail.private</code>, and our public key, <code>mail.txt</code>.</p></div>
<div class="paragraph"><p>We should make sure only OpenDKIM can read the private key, so that a malicious
program or user on the same server won&#8217;t be able to forge our signature:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>chmod <span class="m">600</span> mail.private
<span class="nv">$ </span>chown opendkim:opendkim mail.private
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_dkim_public_key_dns_record">DKIM public key DNS record</h4>
<div class="paragraph"><p>The next step is to publish our public key through DNS, so that any recipient
e-mail program can verify our signature. If we look at our public key <code>mail.txt</code>
generated in the previous step, it should look like something like this:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>mail._domainkey IN      TXT     ( "v=DKIM1; k=rsa; "
          "p=&lt;alphabetical soup&gt;" )  ; ----- DKIM key mail for example.com</code></pre>
</div></div>
<div class="paragraph"><p>Create the following <strong>TXT</strong> DNS record for <code>example.com</code> (how to update DNS
records will depend on the DNS hosting provider):</p></div>
<div class="ulist"><ul>
<li>
<p>
Name: <code>mail._domainkey.example.com</code>
</p>
</li>
<li>
<p>
Value: <code>v=DKIM1; k=rsa; p=&lt;alphabetical soup&gt;</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>where <code>&lt;alphabetical soup&gt;</code> is the public key found in <code>mail.txt</code> after <code>p=</code>.
Note that DNS records will take a while (depending on our provider, up to a day)
to propagate.</p></div>
</div>
<div class="sect3">
<h4 id="_opendkim_server">OpenDKIM server</h4>
<div class="paragraph"><p>We can now start the OpenDKIM server with</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo /etc/init.d/opendkim start
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_postfix">Postfix</h4>
<div class="paragraph"><p>The last step is to tell Postfix to use OpenDKIM to sign outgoing e-mail
messages. Add the following to <code>/etc/postfix/main.cf</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># Milter settings.</span>
<span class="nv">milter_protocol</span> <span class="o">=</span> 2
<span class="nv">milter_default_action</span> <span class="o">=</span> accept
<span class="c"># OpenDKIM runs on port 12301.</span>
<span class="nv">smtpd_milters</span> <span class="o">=</span> inet:localhost:12301
<span class="nv">non_smtpd_milters</span> <span class="o">=</span> inet:localhost:12301
</pre></div></div></div>
<div class="paragraph"><p>If you already have other milters configured (such as
<a href="http://spamassassin.apache.org/">SpamAssassin</a>), simply add
<code>inet:localhost:12301</code> to your existing <code>smtpd_milters</code> and <code>non_smtpd_milters</code>
lines, prefixed by a comma.</p></div>
<div class="paragraph"><p>Let&#8217;s now restart Postfix with the new configuration:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo postfix reload
</pre></div></div></div>
<div class="paragraph"><p>&#8230;and we&#8217;re done!</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_srs">Step 2: SRS</h3>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Sender_Rewriting_Scheme">SRS</a>, short for <em>Sender
Rewriting Scheme</em>, is a standard for including forwarding / relay information in
a forwarded / relayed e-mail message.</p></div>
<div class="paragraph"><p>For example, suppose <code>alice@hotmail.com</code> sends an e-mail to <code>john@example.com</code>,
and our Postfix server on <code>myserver.example.com</code> forwards this e-mail to
<code>john123@gmail.com</code>. SRS allows our Postfix server on <code>myserver.example.com</code> to
attach a virtual sticky note on the e-mail message explaining this situation to
Gmail. Otherwise, Gmail might become suspicious of why <code>myserver.example.com</code> is
producing messages that purport to come from <code>hotmail.com</code>, which spammers and
phishers are wont to do.</p></div>
<div class="paragraph"><p>We will use <a href="https://github.com/roehling/postsrsd">PostSRSd</a> to implement SRS in
our Postfix server. It works out of the box with Postfix and is a breeze to set
up, but unfortunately is not included in the official Ubuntu / Debian package
repositories.</p></div>
<div class="sect3">
<h4 id="_opensrsd">OpenSRSd</h4>
<div class="paragraph"><p>Let&#8217;s build and install OpenSRSd from source:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># Dependencies.</span>
<span class="nv">$ </span>sudo apt-get install unzip cmake

<span class="c"># Download and extract source code from GitHub.</span>
<span class="nv">$ </span><span class="nb">cd</span> /tmp
<span class="nv">$ </span>curl -L -o postsrsd.zip <span class="se">\</span>
    https://github.com/roehling/postsrsd/archive/master.zip
<span class="nv">$ </span>unzip postsrsd.zip

<span class="c"># Build and install.</span>
<span class="nv">$ </span><span class="nb">cd </span>postsrsd-master
<span class="nv">$ </span>mkdir build
<span class="nv">$ </span><span class="nb">cd </span>build
<span class="nv">$ </span>cmake -DCMAKE_INSTALL_PREFIX<span class="o">=</span>/usr ../
<span class="nv">$ </span>make
<span class="nv">$ </span>sudo make install
</pre></div></div></div>
<div class="paragraph"><p>The default config provided by PostSRSd (<code>/etc/default/postsrsd</code>) will pretty
much work out of the box for our case.</p></div>
<div class="paragraph"><p>The install script will also conveniently install an Upstart script for
PostSRSd. Let&#8217;s start it now:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo service postsrsd start
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_postfix_2">Postfix</h4>
<div class="paragraph"><p>Finally, we configure Postfix to use PostSRSd. Add the following to
<code>/etc/postfix/main.cf</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># PostSRSd settings.</span>
<span class="nv">sender_canonical_maps</span> <span class="o">=</span> tcp:127.0.0.1:10001
<span class="nv">sender_canonical_classes</span> <span class="o">=</span> envelope_sender
<span class="nv">recipient_canonical_maps</span> <span class="o">=</span> tcp:127.0.0.1:10002
<span class="nv">recipient_canonical_classes</span><span class="o">=</span> envelope_recipient,header_recipient
</pre></div></div></div>
<div class="paragraph"><p>And restart Postfix with the new configuration:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo postfix reload
</pre></div></div></div>
<div class="paragraph"><p>That&#8217;s it!</p></div>
</div>
</div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Dec 09, 2014
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="http://seasonofcode.com/tag/misc.html">Misc</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="http://seasonofcode.com/posts/setting-up-dkim-and-srs-in-postfix.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="http://seasonofcode.com/posts/setting-up-dkim-and-srs-in-postfix.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="http://seasonofcode.com/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html" rel="bookmark">
      Custom Domain E-mails With Postfix and Gmail: The Missing Tutorial
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2014-11-06T16:50:00-08:00">
          Nov 06, 2014
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="http://seasonofcode.com/tag/featured.html">Featured</a>,            <a href="http://seasonofcode.com/tag/misc.html">Misc</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="http://seasonofcode.com/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>Custom domain e-mail addresses, like <code>john@johnscompany.com</code>, are cool and
professional-looking. Would <em>you</em> want to e-mail potential clients as
<code>john123@gmail.com</code>?</p></div>
<div class="paragraph"><p>On the other hand, Gmail has great reliability, speed, spam filtration, and app
support. Wouldn&#8217;t it be great if we could send and receive e-mail as
<code>john@johnscompany.com</code>, but right from the comfort of our Gmail account?</p></div>
<div class="paragraph"><p>Today, if we want to <strong>use Gmail to send and receive e-mails on a custom domain</strong>,
we have a couple of options:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><a href="http://www.google.com/work/apps/business/">Google Apps for Work</a></strong> is Google&#8217;s
  own offering. It&#8217;s simple to set up and manage, but it&#8217;s pretty pricey at
  $5/mo per user, especially if we don&#8217;t need the bundled collaborative
  features like Google Docs and Calendar.
</p>
</li>
<li>
<p>
<strong>Third-party services</strong> could get the job done at a
  lower price point; for example, <a href="https://pobox.com/">Pobox</a> offers plans
  starting at $20/yr. The downside is that we will have to trust another
  organization with our e-mail.
</p>
</li>
<li>
<p>
<strong>Set up our own e-mail forwarding server</strong>. It&#8217;s fairly easy (if we
  follow this guide :) and if we already have shared / dedicated hosting or a
  VPS, this is basically free and gives us total control over our e-mail.
</p>
</li>
</ul></div>
<div class="paragraph"><p>If you want to host <strong>custom domain e-mails in Gmail without paying for Google
Apps</strong> or a third-party service, this tutorial is for you. It will show you how
to quickly set up you own e-mail forwarding / relay server, and how to integrate
it seamlessly with Gmail.</p></div>
<div class="sect2">
<h3 id="_prerequisites">Prerequisites</h3>
<div class="paragraph"><p>For this tutorial, we&#8217;ll assume we have access to:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>VPS or shared / dedicated hosting</strong>, with a dedicated IP address and capable
  of listening on ports 25 and 587. We will use a Ubuntu server for
  the examples.
</p>
</li>
<li>
<p>
<strong>DNS records for our domain</strong>. How DNS records are manipulated depends on the
  DNS hosting provider (or DNS server configuration).
</p>
</li>
</ul></div>
<div class="paragraph"><p>We&#8217;ll assume</p></div>
<div class="ulist"><ul>
<li>
<p>
We have a domain <code>example.com</code>;
</p>
</li>
<li>
<p>
We have a server <code>myserver.example.com</code>;
</p>
</li>
<li>
<p>
We want to use the Gmail account <code>john123@gmail.com</code> to manage
  <code>john@example.com</code>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_step_1_dns_setup">Step 1: DNS Setup</h3>
<div class="paragraph"><p>The first step in setting up our e-mail forwarding server is to add MX, PTR and
<a href="http://en.wikipedia.org/wiki/Sender_Policy_Framework">SPF</a> DNS records for our
server. This is really important as many e-mail providers, in order to prevent
spam, will refuse to talk to mail servers without proper MX, PTR and SPF records
set up. How to update DNS records will depend on the DNS hosting provider.</p></div>
<div class="paragraph"><p>The following is what we need:</p></div>
<div class="ulist"><ul>
<li>
<p>
An <strong>MX</strong> record for <code>example.com</code>, pointing to <code>myserver.example.com</code>.
</p>
<div class="paragraph"><p>This tells the world that e-mails to <code>&lt;whatever&gt;@example.com</code> should be
delivered to the server <code>myserver.example.com</code>.</p></div>
</li>
<li>
<p>
An <strong>A</strong> record for <code>myserver.example.com</code>, pointing to the IP address of our
  server.
</p>
</li>
<li>
<p>
A <strong>PTR</strong> (reverse DNS) record mapping the IP address of our server to
  <code>myserver.example.com</code>.
</p>
<div class="paragraph"><p>This allows Gmail to verify the legitimacy of our server via its IP when Gmail
receives a forwarded e-mail from it.</p></div>
</li>
<li>
<p>
A <strong>TXT</strong> record, with key <code>example.com</code> and value <code>v=spf1 mx ~all</code>.
</p>
<div class="paragraph"><p>This is an <a href="http://en.wikipedia.org/wiki/Sender_Policy_Framework">SPF</a> record; it
tells Gmail that the servers specified in the MX records of <code>example.com</code>, in
this case only <code>myserver.example.com</code>, are allowed to send e-mails purporting to
be from <code>&lt;whatever&gt;@example.com</code>. All other servers attempting to do the same
will be rejected. This should be a sane default value, but feel free to custom
it as you like.</p></div>
</li>
</ul></div>
<div class="paragraph"><p>DNS records will take a while (depending on our provider, up to a day) to
propagate. Until they do, e-mails forwarded by our new e-mail server may get
marked as spam or rejected outright.</p></div>
</div>
<div class="sect2">
<h3 id="_step_2_receiving_e_mail">Step 2: Receiving E-mail</h3>
<div class="paragraph"><p>We&#8217;ll first set up an e-mail forwarding server which will let we receive e-mails
sent to our domains.</p></div>
<div class="paragraph"><p>We will use <a href="http://www.postfix.org">Postfix</a> as the e-mail server. Let&#8217;s start by
installing the necessary packages. We will assume a Ubuntu server in the
examples below; if you&#8217;re using a different distribution, please consult your
distribution&#8217;s documentation for the right commands.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ sudo DEBIAN_FRONTEND=noninteractive apt-get install postfix</code></pre>
</div></div>
<div class="paragraph"><p>In the above command, we skip the <code>debconf</code> configuration UI with
<code>DEBIAN_FRONTEND=noninteractive</code> as we will edit the configuration files
directly.</p></div>
<div class="sect3">
<h4 id="_etc_postfix_main_cf">/etc/postfix/main.cf</h4>
<div class="paragraph"><p>Open up <code>/etc/postfix/main.cf</code> in your favorite editor. This file will come
pre-populated with a bunch of config options and comments.  Replace the contents
of the file with the following (you can comment out the original contents for
reference):</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># /etc/postfix/main.cf</span>

<span class="c"># Host and site name.</span>
<span class="n">myhostname</span> <span class="o">=</span> <span class="n">myserver</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">mydomain</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">myorigin</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>

<span class="c"># Virtual aliases.</span>
<span class="n">virtual_alias_domains</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">virtual_alias_maps</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">postfix</span><span class="o">/</span><span class="n">virtual</span>
</pre></div></div></div>
<div class="paragraph"><p>The first few lines are pretty straightforward; they tell Postfix how to
identify itself to the world. The last two lines tell Postfix to forward e-mails
sent to <code>&lt;whatever&gt;@example.com</code> to another e-mail provider (Gmail), and that the
forwarding is configured in the database file <code>/etc/postfix/virtual</code>.</p></div>
</div>
<div class="sect3">
<h4 id="_etc_postfix_virtual">/etc/postfix/virtual</h4>
<div class="paragraph"><p>Let&#8217;s now open up <code>/etc/postfix/virtual</code> and fill in our forwarding
configuration:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># /etc/postfix/virtual</span>

<span class="c"># Forwarding mapping, one from-to address pair per line. The format is:</span>
<span class="c">#     &lt;forward-from-addr&gt; &lt;whitespace&gt; &lt;forward-to-addr&gt;</span>
john@example.com        john123@gmail.com
</pre></div></div></div>
<div class="paragraph"><p>We can add as many forwarding rules as you want, one on each line.  We can use
any number of tabs / whitespaces between the forward-from and forward-to
addresses.</p></div>
</div>
<div class="sect3">
<h4 id="_update_lookup_table">Update lookup table</h4>
<div class="paragraph"><p>It turns out that Postfix doesn&#8217;t actually read <code>/etc/postfix/virtual</code>
(surprise!); instead, what it reads is a lookup table generated from it.
So, let&#8217;s generate the lookup table from our <code>/etc/postfix/virtual</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo postmap /etc/postfix/virtual
</pre></div></div></div>
<div class="paragraph"><p><strong>Note</strong>: we must re-run this command every time we modify
<code>/etc/postfix/virtual</code>!</p></div>
</div>
<div class="sect3">
<h4 id="_re_start_postfix">(Re)start Postfix</h4>
<div class="paragraph"><p>It&#8217;s now time to (re)start Postfix with our new configuration:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo postfix start
<span class="nv">$ </span>sudo postfix reload
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_testing">Testing</h4>
<div class="paragraph"><p>We should test our brand-new Postfix server by sending an e-mail to our
forward-from address. You might want to check out
<a href="http://articles.slicehost.com/2008/8/6/postfix-using-telnet-to-test-postfix">these</a>
<a href="https://workaround.org/ispmail/lenny/test-mail-through-telnet">tutorials</a> for
testing directly with the <code>telnet</code> command.</p></div>
<div class="paragraph"><p>If you received the e-mail in your Gmail inbox, congratulations! Otherwise,
check the Postfix logs at <code>/var/log/mail.log</code> (or with <code>journalctl -u postfix</code>
if using Systemd) for errors. The most likely cause of issues is that DNS
records have not propagated yet, in which case we&#8217;re likely to see a "rate
limited" or "rejected for spam" type error message.</p></div>
<div class="paragraph"><p>If we only want to <em>receive</em> but don&#8217;t care about <em>sending</em> e-mails as
<code>john@example.com</code>, then this is all we need.</p></div>
<div class="paragraph"><p>Otherwise, let&#8217;s move on to
configuring Postfix to support sending e-mails from Gmail.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_sending_e_mail">Step 3: Sending E-mail</h3>
<div class="paragraph"><p>Gmail requires a relay server (a server that will send e-mails to their
destination on behalf it) to speak
<a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a>, which protects the
communication between Gmail and the relay server.</p></div>
<div class="paragraph"><p>We will use <a href="http://www.cyrusimap.org/">Cyrus SASL</a> for this task. To install:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo apt-get install sasl2-bin libsasl2-modules
</pre></div></div></div>
<div class="sect3">
<h4 id="_user_name_amp_password">User name &amp; password</h4>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Open_mail_relay">Open relays</a> are a terrible idea.
We want to protect our e-mail server with a user name and password so that it
will let Gmail send e-mails through it, but block spammers and other evil
actors.</p></div>
<div class="paragraph"><p>Cyrus SASL supports several backends for storing user names and passwords,
including MySQL and PAM. However, we will go with the simplest backend&#8201;&#8212;&#8201;a
plain database file.</p></div>
<div class="paragraph"><p>Let&#8217;s create the user name / password database file in the default location
<code>/etc/sasldb2</code>, with a single user named <code>smtp</code> (we can change the user name to
anything we want):</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo saslpasswd2 -c -u example.com smtp
</pre></div></div></div>
<div class="paragraph"><p>Verify with:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo sasldblistusers2
</pre></div></div></div>
<div class="paragraph"><p>Now, we make sure only Postfix can read this file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo chmod <span class="m">400</span> /etc/sasldb2
<span class="nv">$ </span>sudo chown postfix /etc/sasldb2
</pre></div></div></div>
<div class="paragraph"><p>Lastly, we tell Cyrus SASL to use the file-based database to authenticate.
Create the file <code>/etc/postfix/sasl/smtpd.conf</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>pwcheck_method: auxprop
auxprop_plugin: sasldb
mech_list: PLAIN LOGIN CRAM-MD5 DIGEST-MD5 NTLM
log_level: 7</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_ssl_certificate">SSL Certificate</h4>
<div class="paragraph"><p>We need an SSL certificate to enable TLS. While a proper SSL certificate signed
by a Certificate Authority (CA) can be pricey, it turns out that a simple
self-signed certificate suffices and works just fine.</p></div>
<div class="paragraph"><p>So, let&#8217;s generate one.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<strong>Generate an RSA private/public key pair.</strong> Note that you MUST supply a password
  to this command; the password will be removed in step 3.
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>openssl genrsa -des3 -out example.key 1024
</pre></div></div></div>
</li>
<li>
<p>
<strong>Generate a Certificate Signing Request (CSR).</strong> Make sure to enter
  <code>myserver.example.com</code> when prompted for the "Common Name".
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>openssl req -new -key example.key -out example.csr
</pre></div></div></div>
</li>
<li>
<p>
<strong>Remove RSA private/public key password.</strong>
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>mv example.key example.key.orig
<span class="nv">$ </span>openssl rsa -in example.key.orig -out example.key
</pre></div></div></div>
</li>
<li>
<p>
<strong>Generate a self-signed certificate.</strong> In the example, the generated
  certificate will be valid for 10 years.
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>openssl x509 -req <span class="se">\</span>
    -days <span class="m">3650</span> -in example.csr -signkey example.key -out example.crt
</pre></div></div></div>
</li>
<li>
<p>
<strong>Create a PEM file.</strong>
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>cat example.crt example.key &gt; example.pem
</pre></div></div></div>
</li>
<li>
<p>
<strong>Move and protect the PEM file.</strong>
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo mv example.pem /etc/postfix/example.pem
<span class="nv">$ </span>sudo chmod <span class="m">400</span> /etc/postfix/example.pem
<span class="nv">$ </span>sudo chown postfix /etc/postfix/example.pem
</pre></div></div></div>
</li>
</ol></div>
<div class="paragraph"><p><strong>Note:</strong> Make sure to protect the generated private key and certificate with care!</p></div>
</div>
<div class="sect3">
<h4 id="_relay_server">Relay server</h4>
<div class="paragraph"><p>The final step is to configure Postfix to enable relaying of e-mail on behalf of
Gmail.</p></div>
<div class="paragraph"><p>Let&#8217;s open up <code>/etc/postfix/master.cf</code>. This file should already contain a bunch
of config options, some of which are commented out. Uncomment the lines starting
with <code>submission</code> and edit them to match the following:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>submission inet n       -       n       -       -       smtpd
  -o syslog_name=postfix/submission
  -o smtpd_tls_security_level=may
  -o smtpd_tls_cert_file=/etc/postfix/example.pem
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_reject_unlisted_recipient=no
  -o smtpd_relay_restrictions=permit_sasl_authenticated,reject
  -o milter_macro_daemon_name=ORIGINATING</code></pre>
</div></div>
<div class="paragraph"><p>A Postfix restart is due after all these changes:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo postfix reload
</pre></div></div></div>
<div class="paragraph"><p>If all went well, you should see Postfix serving a relay server, protected by
our user name and password in <code>/etc/sasldb2</code>, on port 587.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_configure_gmail">Step 4: Configure Gmail</h3>
<div class="paragraph"><p>Finally, let&#8217;s log in to Gmail and tell it about our brand new server. (Note
that the new Inbox UI does not yet support all the settings available in the
legacy interface at the time of writing, so these instructions apply to the
legacy interface.)</p></div>
<div class="paragraph"><p>Let&#8217;s go to <em>Settings</em> &gt; <em>Accounts and Import</em> and click <em>Add another email
address you own</em>.
<div align="center"><img src="/assets/files/gmail_1.png"></div>
In the dialog that pops up, fill in our target e-mail address and click <em>Next
Step</em>.
<div align="center"><img src="/assets/files/gmail_2.png"></div>
In the next dialog, enter the address of our e-mail server
(<code>myserver.example.com</code>), and the user name and password we set up using
<code>saslpasswd2</code> above. Make sure the user name is suffixed with our domain name
(so <code>smtp@example.com</code> rather than just <code>smtp</code>). Check that the correct port
(587) and the correct security protocol (TLS) are selected, then click <em>Add
Account</em>.
<div align="center"><img src="/assets/files/gmail_3.png"></div>
If all goes well, we should see a dialog like the following:
<div align="center"><img src="/assets/files/gmail_4.png"></div>
And we should receive an e-mail, forwarded by our mail server set up in the
first part, to our <code>john123@gmail.com</code> address. Click on the link inside the
e-mail and we&#8217;re done!</p></div>
<div class="paragraph"><p>Now, in any e-mail compose / reply window, you should be able to select
<code>john@example.com</code> in the drop-down list next to "From". Congrats!</p></div>
<div class="paragraph"><p>If, on the other hand, you see an error like the following:
<div align="center"><img src="/assets/files/gmail_5.png"></div>
You should check the Postfix logs at <code>/var/log/mail.log</code> (or with <code>journalctl -u
postfix</code> if using Systemd) for any errors.</p></div>
</div>
<div class="sect2">
<h3 id="_optional_step_5_setup_dkim_and_srs">[Optional] Step 5: Setup DKIM and SRS</h3>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/DomainKeys_Identified_Mail">DKIM</a>, short for
<em>DomainKeys Identified Mail</em>, is e-mail validation system for preventing e-mail
spoofing. <a href="https://support.google.com/mail/answer/180707?hl=en">Google recommends
setting up DKIM</a>; if we don&#8217;t, the e-mail messages that we forward to Gmail have
a higher probability of getting marked as spam.</p></div>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Sender_Rewriting_Scheme">SRS</a>, short for <em>Sender
Rewriting Scheme</em>, is a relatively new standard that e-mail forwarding servers
are recommended to adopt, and it also helps reduce the likelihood of our
forwarded e-mail messages getting marked as spam.</p></div>
<div class="paragraph"><p>Thus, while technically optional, it&#8217;s a good idea to configure our Postfix
server to support both these standards. See my follow-up tutorial on
<a href="/posts/setting-up-dkim-and-srs-in-postfix.html">Setting Up DKIM And SRS In
Postfix</a> for a detailed step-by-step guide.</p></div>
</div>
<div class="sect2">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph"><p>In this post, we have set up a Postfix e-mail server that accomplishes the
following:</p></div>
<div class="ulist"><ul>
<li>
<p>
E-mails sent to <code>john@example.com</code> is received by Postfix on
  <code>myserver.example.com</code> port 25, and forwarded to <code>john123@gmail.com</code>;
</p>
</li>
<li>
<p>
Gmail will let you select <code>john@example.com</code> as a "from" address when
  composing / replying to an e-mail, and will relay such e-mails through Postfix
  on <code>myserver.example.com</code> port 587 using a configured user name / password
  combination.
</p>
</li>
</ul></div>
<div class="paragraph"><p>I hope you found this guide useful, and if you have any thoughts / questions,
you&#8217;re more than welcome to leave a comment below. Cheers!</p></div>
</div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Nov 06, 2014
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="http://seasonofcode.com/tag/featured.html">Featured</a>,          <a href="http://seasonofcode.com/tag/misc.html">Misc</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="http://seasonofcode.com/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="http://seasonofcode.com/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="http://seasonofcode.com/posts/how-to-add-custom-build-steps-and-commands-to-setuppy.html" rel="bookmark">
      How To Add Custom Build Steps and Commands To setup.py
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2014-10-07T14:53:00-07:00">
          Oct 07, 2014
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="http://seasonofcode.com/tag/python.html">Python</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="http://seasonofcode.com/posts/how-to-add-custom-build-steps-and-commands-to-setuppy.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>A <code>setup.py</code> script using
<a href="https://docs.python.org/2/distutils/introduction.html"><code>distutils</code></a> /
<a href="https://pythonhosted.org/setuptools/setuptools.html"><code>setuptools</code></a> is the
standard way to package Python code. Often, however, we need to perform custom
actions for code generation, running tests, profiling, or building
documentation, etc., and we&#8217;d like to integrate these actions into setup.py. In
other words, we&#8217;d like to add custom steps to <code>setup.py build</code> or <code>setup.py
install</code>, or add a new command altogether to <code>setup.py</code>.</p></div>
<div class="paragraph"><p>Let&#8217;s see how this is done.</p></div>
<div class="sect2">
<h3 id="_adding_custom_code_setup_py_code_commands_and_options">Adding Custom <code>setup.py</code> Commands and Options</h3>
<div class="paragraph"><p>Let&#8217;s implement a custom command that runs <a href="http://www.pylint.org/">Pylint</a> on all
Python files in our project. The high level idea is:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Implement command as a subclass of <code>distutils.cmd.Command</code>;
</p>
</li>
<li>
<p>
Add the newly defined command class to the <code>cmdclass</code> argument to <code>setup()</code>.
</p>
</li>
</ol></div>
<div class="paragraph"><p>To see this in action, let&#8217;s add the following to our <code>setup.py</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">distutils.cmd</span>
<span class="kn">import</span> <span class="nn">distutils.log</span>
<span class="kn">import</span> <span class="nn">setuptools</span>
<span class="kn">import</span> <span class="nn">subprocess</span>


<span class="k">class</span> <span class="nc">PylintCommand</span><span class="p">(</span><span class="n">distutils</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">Command</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;A custom command to run Pylint on all Python source files.&quot;&quot;&quot;</span>

  <span class="n">description</span> <span class="o">=</span> <span class="s">&#39;run Pylint on Python source files&#39;</span>
  <span class="n">user_options</span> <span class="o">=</span> <span class="p">[</span>
      <span class="c"># The format is (long option, short option, description).</span>
      <span class="p">(</span><span class="s">&#39;pylint-rcfile=&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;path to Pylint config file&#39;</span><span class="p">),</span>
  <span class="p">]</span>

  <span class="k">def</span> <span class="nf">initialize_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set default values for options.&quot;&quot;&quot;</span>
    <span class="c"># Each user option must be listed here with their default value.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pylint_rcfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

  <span class="k">def</span> <span class="nf">finalize_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Post-process options.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pylint_rcfile</span><span class="p">:</span>
      <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pylint_rcfile</span><span class="p">),</span> <span class="p">(</span>
          <span class="s">&#39;Pylint config file </span><span class="si">%s</span><span class="s"> does not exist.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pylint_rcfile</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run command.&quot;&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/usr/bin/pylint&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pylint_rcfile</span><span class="p">:</span>
      <span class="n">command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--rcfile=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pylint_rcfile</span><span class="p">)</span>
    <span class="n">command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">announce</span><span class="p">(</span>
        <span class="s">&#39;Running command: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">command</span><span class="p">),</span>
        <span class="n">level</span><span class="o">=</span><span class="n">distutils</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


<span class="n">setuptools</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span>
    <span class="n">cmdclass</span><span class="o">=</span><span class="p">{</span>
        <span class="s">&#39;pylint&#39;</span><span class="p">:</span> <span class="n">PylintCommand</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="c"># Usual setup() args.</span>
    <span class="c"># ...</span>
<span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Now, running <code>python setup.py --help-commands</code> will show:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Standard commands:
  ...
Extra commands:
  pylint: run Pylint on Python source files
  ...</code></pre>
</div></div>
<div class="paragraph"><p>We can now run the command we just defined with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ python setup.py pylint</code></pre>
</div></div>
<div class="paragraph"><p>&#8230;or with a custom option:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ python setup.py pylint --pylint-rcfile=.pylintrc</code></pre>
</div></div>
<div class="paragraph"><p>To learn more, you can check out documentation on
<a href="https://docs.python.org/2/distutils/apiref.html#creating-a-new-distutils-command">inheriting
from <code>distutils.cmd.Command</code></a> as well as the source code of some built-in
commands, such as
<a href="https://bitbucket.org/pypa/setuptools/src/312a67d000cb05d15b854957466c4751cf5e1c08/setuptools/command/build_py.py?at=default"><code>build_py</code></a>.</p></div>
</div>
<div class="sect2">
<h3 id="_adding_custom_steps_to_code_setup_py_build_code">Adding Custom Steps to <code>setup.py build</code></h3>
<div class="paragraph"><p>Let&#8217;s say we are really paranoid about code style and we&#8217;d like to run Pylint as
part of <code>setup.py build</code>. We can do this in the following manner:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Create a subclass of <code>setuptools.command.build_py.build_py</code> (or
  <code>distutils.command.build_py.build_py</code> if using <code>distutils</code>) that invokes our
  new Pylint command;
</p>
</li>
<li>
<p>
Add the newly defined command class to the <code>cmdclass</code> argument to <code>setup()</code>.
</p>
</li>
</ol></div>
<div class="paragraph"><p>For example, we can implement the following in our <code>setup.py</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">setuptools.command.build_py</span>


<span class="k">class</span> <span class="nc">BuildPyCommand</span><span class="p">(</span><span class="n">setuptools</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">build_py</span><span class="o">.</span><span class="n">build_py</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Custom build command.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_command</span><span class="p">(</span><span class="s">&#39;pylint&#39;</span><span class="p">)</span>
    <span class="n">setuptools</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">build_py</span><span class="o">.</span><span class="n">build_py</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="n">setuptools</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span>
    <span class="n">cmdclass</span><span class="o">=</span><span class="p">{</span>
        <span class="s">&#39;pylint&#39;</span><span class="p">:</span> <span class="n">PylintCommand</span><span class="p">,</span>
        <span class="s">&#39;build_py&#39;</span><span class="p">:</span> <span class="n">BuildPyCommand</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="c"># Usual setup() args.</span>
    <span class="c"># ...</span>
<span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>For more examples, I encourage you to check out the
<a href="https://bitbucket.org/pypa/setuptools/src/312a67d000cb05d15b854957466c4751cf5e1c08/setuptools/command/?at=default"><code>setuptools</code>
source code</a>.</p></div>
</div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Oct 07, 2014
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="http://seasonofcode.com/tag/python.html">Python</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="http://seasonofcode.com/posts/how-to-add-custom-build-steps-and-commands-to-setuppy.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="http://seasonofcode.com/posts/how-to-add-custom-build-steps-and-commands-to-setuppy.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="http://seasonofcode.com/posts/announcing-asciidoclive.html" rel="bookmark">
      Announcing AsciiDocLIVE
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2014-06-11T18:07:00-07:00">
          Jun 11, 2014
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="http://seasonofcode.com/tag/projects.html">Projects</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="http://seasonofcode.com/posts/announcing-asciidoclive.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>I am very pround to announce the alpha launch of <strong>AsciiDocLIVE</strong>
(<a href="https://asciidoclive.com/">https://asciidoclive.com/</a>), a <strong>free online
<a href="http://www.methods.co.nz/asciidoc/">AsciiDoc</a> editor</strong> with instant live preview,
syntax highlighting, and more!</p></div>
<div class="sect2">
<h3 id="_the_idea">The Idea</h3>
<div class="paragraph"><p>The idea for <a href="https://asciidoclive.com/">AsciiDocLIVE</a> struck me one day while
writing a blog post. Being a fan of
<a href="http://www.methods.co.nz/asciidoc/">AsciiDoc</a>, I use AsciiDoc for this blog, but
the repetitive cycle of edit-compile-preview is pretty tedious. I realized that
there wasn&#8217;t a good AsciiDoc editor that supported live previews (like
<a href="http://dillinger.io">Dillinger</a> or <a href="http://markable.in/">Markable</a> for
<a href="http://daringfireball.net/projects/markdown">Markdown</a>). So, I hacked up a quick
prototype in my spare time, and <a href="https://asciidoclive.com/">AsciiDocLIVE</a> was
born!</p></div>
</div>
<div class="sect2">
<h3 id="_features">Features</h3>
<div class="paragraph"><p>Features included in this alpha launch:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>Instant live preview</strong>: type in the left pane, see rendered result in the
  right pane.
</p>
</li>
<li>
<p>
<strong>Smart error messages</strong>: errors generated by the AsciiDoc compiler are
  displayed and linked to the offending line in the source text.
</p>
</li>
<li>
<p>
<strong>Syntax highlighting</strong>
</p>
</li>
</ul></div>
<div class="paragraph"><p>To be available soon:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>Saving documents</strong>
</p>
</li>
<li>
<p>
<strong>Importing from and exporting to</strong> Dropbox / Google Drive
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_feedback">Feedback</h3>
<div class="paragraph"><p>Bugs? Improvement ideas? All feedback is appreciated at
<a href="mailto:ji@chu4n.com">ji@chu4n.com</a>.</p></div>
</div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Jun 11, 2014
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="http://seasonofcode.com/tag/projects.html">Projects</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="http://seasonofcode.com/posts/announcing-asciidoclive.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="http://seasonofcode.com/posts/announcing-asciidoclive.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
<div>
  <ul class="pager">
    <!--- <li class="previous disabled"><a>&larr; Previous</a></li> -->
    <li class="next"><a href="http://seasonofcode.com/index2.html">Next &rarr;</a></li>
  </ul>
</div>
    </section>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p class="footer-text text-muted">&copy; 2015 Chuan Ji</p>
      </div>
    </footer>
    <script src="http://seasonofcode.com/theme/jquery.min.js"></script>
    <script src="http://seasonofcode.com/theme/bootstrap/js/bootstrap.min.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-21264754-1', 'auto');
  ga('send', 'pageview');

</script>

<script type="text/javascript">
  var disqus_shortname = 'cjix';
  (function () {
      var s = document.createElement('script');
      s.async = true;
      s.type = 'text/javascript';
      s.src = '//' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] ||
       document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

  </body>
</html>
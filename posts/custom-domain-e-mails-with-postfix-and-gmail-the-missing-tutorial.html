<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <title>Custom Domain E-mails With Postfix and Gmail: The Missing Tutorial - Season of Code</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="shortcut icon" href="https://seasonofcode.com/assets/favicon.ico" />
      <link href="https://seasonofcode.com/theme/asciidoc.min.css?0e298cf5" rel="stylesheet" />
    <link href="https://seasonofcode.com/theme/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://seasonofcode.com/theme/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
      <link href="https://seasonofcode.com/theme/style.min.css?8c372564" rel="stylesheet" />
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://seasonofcode.com/theme/html5shiv.min.js"></script>
    <script src="https://seasonofcode.com/theme/respond.min.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://seasonofcode.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Season of Code Full Atom Feed" />
    <link href="https://seasonofcode.com/feeds/misc.atom.xml" type="application/atom+xml" rel="alternate" title="Season of Code Categories Atom Feed" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-21264754-1', 'auto');
  ga('send', 'pageview');

</script>

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(["setDomains", ["*.seasonofcode.com"]]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//a.chu4n.com/";
    _paq.push(['setTrackerUrl', u+'js/']);
    _paq.push(['setSiteId', 2]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'js/'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//a.chu4n.com/js/?idsite=2" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

    <meta name="google-site-verification" content="g_MrQjKfWWKOccQYg--leY8NlSev0om0sy2vrBLYoZU">
    <meta name="google-site-verification" content="_r0m7LYlH2JjDgeTysX9Fv0OzQG1xUEAU6x2uSr9nH8">

    <meta name="msvalidate.01" content="F10D3C66876F50983761BFE53E2B943A4">

  <link rel="canonical" href="https://seasonofcode.com/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html">
  </head>
  <body id="index" class="archive">
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <nav id="header" class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <i class="fa fa-bars fa-lg"></i>
          </button>
          <a class="navbar-brand" href="https://seasonofcode.com">
            season <span class="of">of</span> code
          </a>
        </div>
        <div class="collapse navbar-collapse navbar-right">
          <ul class="nav navbar-nav">
            <li>
              <a href="https://seasonofcode.com/tag/featured.html">Featured</a>
            </li>
            <li id="header-tags-dropdown" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                role="button">Tags <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu">
                  <li><a href="https://seasonofcode.com/tag/android.html">Android</a></li>
                  <li><a href="https://seasonofcode.com/tag/c.html">C++</a></li>
                  <li><a href="https://seasonofcode.com/tag/featured.html">Featured</a></li>
                  <li><a href="https://seasonofcode.com/tag/linux.html">Linux</a></li>
                  <li><a href="https://seasonofcode.com/tag/misc.html">Misc</a></li>
                  <li><a href="https://seasonofcode.com/tag/projects.html">Projects</a></li>
                  <li><a href="https://seasonofcode.com/tag/python.html">Python</a></li>
                  <li><a href="https://seasonofcode.com/tag/window-manager.html">Window Manager</a></li>
              </ul>
            </li>
            <li>
              <a href="https://seasonofcode.com/archives.html">Archives</a>
            </li>
            <li><a href="https://seasonofcode.com/pages/about.html">About</a></li>
          </ul>
        </div>
        <!-- /.navbar-collapse -->
      </div>
    </nav>
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-8 col-md-offset-2">
  <section id="content" class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="https://seasonofcode.com/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html" rel="bookmark">
      Custom Domain E-mails With Postfix and Gmail: The Missing Tutorial
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2014-11-06T16:50:00-08:00">
          Nov 06, 2014
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="https://seasonofcode.com/tag/featured.html">Featured</a>,            <a href="https://seasonofcode.com/tag/misc.html">Misc</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="https://seasonofcode.com/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>Custom domain e-mail addresses, like <code>john@johnscompany.com</code>, are cool and
professional-looking. Would <em>you</em> want to e-mail potential clients as
<code>john123@gmail.com</code>?</p></div>
<div class="paragraph"><p>On the other hand, Gmail has great reliability, speed, spam filtration, and app
support. Wouldn&#8217;t it be great if we could send and receive e-mail as
<code>john@johnscompany.com</code>, but right from the comfort of our Gmail account?</p></div>
<div class="paragraph"><p>Today, if we want to <strong>use Gmail to send and receive e-mails on a custom domain</strong>,
we have a couple of options:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><a href="http://www.google.com/work/apps/business/">Google Apps for Work</a></strong> is Google&#8217;s
  own offering. It&#8217;s simple to set up and manage, but it&#8217;s pretty pricey at
  $5/mo per user, especially if we don&#8217;t need the bundled collaborative
  features like Google Docs and Calendar.
</p>
</li>
<li>
<p>
<strong>Third-party services</strong> could get the job done at a
  lower price point; for example, <a href="https://pobox.com/">Pobox</a> offers plans
  starting at $20/yr. The downside is that we will have to trust another
  organization with our e-mail.
</p>
</li>
<li>
<p>
<strong>Set up our own e-mail forwarding server</strong>. It&#8217;s fairly easy (if we
  follow this guide :) and if we already have shared / dedicated hosting or a
  VPS, this is basically free and gives us total control over our e-mail.
</p>
</li>
</ul></div>
<div class="paragraph"><p>If you want to host <strong>custom domain e-mails in Gmail without paying for Google
Apps</strong> or a third-party service, this tutorial is for you. It will show you how
to quickly set up you own e-mail forwarding / relay server, and how to integrate
it seamlessly with Gmail.</p></div>
<div class="sect2">
<h3 id="_prerequisites">Prerequisites</h3>
<div class="paragraph"><p>For this tutorial, we&#8217;ll assume we have access to:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>VPS or shared / dedicated hosting</strong>, with a dedicated IP address and capable
  of listening on ports 25 and 587. We will use a Ubuntu server for
  the examples.
</p>
</li>
<li>
<p>
<strong>DNS records for our domain</strong>. How DNS records are manipulated depends on the
  DNS hosting provider (or DNS server configuration).
</p>
</li>
</ul></div>
<div class="paragraph"><p>We&#8217;ll assume</p></div>
<div class="ulist"><ul>
<li>
<p>
We have a domain <code>example.com</code>;
</p>
</li>
<li>
<p>
We have a server <code>myserver.example.com</code>;
</p>
</li>
<li>
<p>
We want to use the Gmail account <code>john123@gmail.com</code> to manage
  <code>john@example.com</code>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_step_1_dns_setup">Step 1: DNS Setup</h3>
<div class="paragraph"><p>The first step in setting up our e-mail forwarding server is to add MX, PTR and
<a href="http://en.wikipedia.org/wiki/Sender_Policy_Framework">SPF</a> DNS records for our
server. This is really important as many e-mail providers, in order to prevent
spam, will refuse to talk to mail servers without proper MX, PTR and SPF records
set up. How to update DNS records will depend on the DNS hosting provider.</p></div>
<div class="paragraph"><p>The following is what we need:</p></div>
<div class="ulist"><ul>
<li>
<p>
An <strong>MX</strong> record for <code>example.com</code>, pointing to <code>myserver.example.com</code>.
</p>
<div class="paragraph"><p>This tells the world that e-mails to <code>&lt;whatever&gt;@example.com</code> should be
delivered to the server <code>myserver.example.com</code>.</p></div>
</li>
<li>
<p>
An <strong>A</strong> record for <code>myserver.example.com</code>, pointing to the IP address of our
  server.
</p>
</li>
<li>
<p>
A <strong>PTR</strong> (reverse DNS) record mapping the IP address of our server to
  <code>myserver.example.com</code>.
</p>
<div class="paragraph"><p>This allows Gmail to verify the legitimacy of our server via its IP when Gmail
receives a forwarded e-mail from it.</p></div>
</li>
<li>
<p>
A <strong>TXT</strong> record, with key <code>example.com</code> and value <code>v=spf1 mx ~all</code>.
</p>
<div class="paragraph"><p>This is an <a href="http://en.wikipedia.org/wiki/Sender_Policy_Framework">SPF</a> record; it
tells Gmail that the servers specified in the MX records of <code>example.com</code>, in
this case only <code>myserver.example.com</code>, are allowed to send e-mails purporting to
be from <code>&lt;whatever&gt;@example.com</code>. All other servers attempting to do the same
will be rejected. This should be a sane default value, but feel free to custom
it as you like.</p></div>
</li>
</ul></div>
<div class="paragraph"><p>DNS records will take a while (depending on our provider, up to a day) to
propagate. Until they do, e-mails forwarded by our new e-mail server may get
marked as spam or rejected outright.</p></div>
</div>
<div class="sect2">
<h3 id="_step_2_receiving_e_mail">Step 2: Receiving E-mail</h3>
<div class="paragraph"><p>We&#8217;ll first set up an e-mail forwarding server which will let we receive e-mails
sent to our domains.</p></div>
<div class="paragraph"><p>We will use <a href="http://www.postfix.org">Postfix</a> as the e-mail server. Let&#8217;s start by
installing the necessary packages. We will assume a Ubuntu server in the
examples below; if you&#8217;re using a different distribution, please consult your
distribution&#8217;s documentation for the right commands.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ sudo DEBIAN_FRONTEND=noninteractive apt-get install postfix</code></pre>
</div></div>
<div class="paragraph"><p>In the above command, we skip the <code>debconf</code> configuration UI with
<code>DEBIAN_FRONTEND=noninteractive</code> as we will edit the configuration files
directly.</p></div>
<div class="sect3">
<h4 id="_etc_postfix_main_cf">/etc/postfix/main.cf</h4>
<div class="paragraph"><p>Open up <code>/etc/postfix/main.cf</code> in your favorite editor. This file will come
pre-populated with a bunch of config options and comments.  Replace the contents
of the file with the following (you can comment out the original contents for
reference):</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># /etc/postfix/main.cf</span>

<span class="c"># Host and site name.</span>
<span class="n">myhostname</span> <span class="o">=</span> <span class="n">myserver</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">mydomain</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">myorigin</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>

<span class="c"># Virtual aliases.</span>
<span class="n">virtual_alias_domains</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">virtual_alias_maps</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">postfix</span><span class="o">/</span><span class="n">virtual</span>
</pre></div></div></div>
<div class="paragraph"><p>The first few lines are pretty straightforward; they tell Postfix how to
identify itself to the world. The last two lines tell Postfix to forward e-mails
sent to <code>&lt;whatever&gt;@example.com</code> to another e-mail provider (Gmail), and that the
forwarding is configured in the database file <code>/etc/postfix/virtual</code>.</p></div>
</div>
<div class="sect3">
<h4 id="_etc_postfix_virtual">/etc/postfix/virtual</h4>
<div class="paragraph"><p>Let&#8217;s now open up <code>/etc/postfix/virtual</code> and fill in our forwarding
configuration:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># /etc/postfix/virtual</span>

<span class="c"># Forwarding mapping, one from-to address pair per line. The format is:</span>
<span class="c">#     &lt;forward-from-addr&gt; &lt;whitespace&gt; &lt;forward-to-addr&gt;</span>
john@example.com        john123@gmail.com
</pre></div></div></div>
<div class="paragraph"><p>We can add as many forwarding rules as you want, one on each line.  We can use
any number of tabs / whitespaces between the forward-from and forward-to
addresses.</p></div>
</div>
<div class="sect3">
<h4 id="_update_lookup_table">Update lookup table</h4>
<div class="paragraph"><p>It turns out that Postfix doesn&#8217;t actually read <code>/etc/postfix/virtual</code>
(surprise!); instead, what it reads is a lookup table generated from it.
So, let&#8217;s generate the lookup table from our <code>/etc/postfix/virtual</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo postmap /etc/postfix/virtual
</pre></div></div></div>
<div class="paragraph"><p><strong>Note</strong>: we must re-run this command every time we modify
<code>/etc/postfix/virtual</code>!</p></div>
</div>
<div class="sect3">
<h4 id="_re_start_postfix">(Re)start Postfix</h4>
<div class="paragraph"><p>It&#8217;s now time to (re)start Postfix with our new configuration:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo postfix start
<span class="nv">$ </span>sudo postfix reload
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_testing">Testing</h4>
<div class="paragraph"><p>We should test our brand-new Postfix server by sending an e-mail to our
forward-from address. You might want to check out
<a href="http://articles.slicehost.com/2008/8/6/postfix-using-telnet-to-test-postfix">these</a>
<a href="https://workaround.org/ispmail/lenny/test-mail-through-telnet">tutorials</a> for
testing directly with the <code>telnet</code> command.</p></div>
<div class="paragraph"><p>If you received the e-mail in your Gmail inbox, congratulations! Otherwise,
check the Postfix logs at <code>/var/log/mail.log</code> (or with <code>journalctl -u postfix</code>
if using Systemd) for errors. The most likely cause of issues is that DNS
records have not propagated yet, in which case we&#8217;re likely to see a "rate
limited" or "rejected for spam" type error message.</p></div>
<div class="paragraph"><p>If we only want to <em>receive</em> but don&#8217;t care about <em>sending</em> e-mails as
<code>john@example.com</code>, then this is all we need.</p></div>
<div class="paragraph"><p>Otherwise, let&#8217;s move on to
configuring Postfix to support sending e-mails from Gmail.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_sending_e_mail">Step 3: Sending E-mail</h3>
<div class="paragraph"><p>Gmail requires a relay server (a server that will send e-mails to their
destination on behalf it) to speak
<a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a>, which protects the
communication between Gmail and the relay server.</p></div>
<div class="paragraph"><p>We will use <a href="http://www.cyrusimap.org/">Cyrus SASL</a> for this task. To install:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo apt-get install sasl2-bin libsasl2-modules
</pre></div></div></div>
<div class="sect3">
<h4 id="_user_name_amp_password">User name &amp; password</h4>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Open_mail_relay">Open relays</a> are a terrible idea.
We want to protect our e-mail server with a user name and password so that it
will let Gmail send e-mails through it, but block spammers and other evil
actors.</p></div>
<div class="paragraph"><p>Cyrus SASL supports several backends for storing user names and passwords,
including MySQL and PAM. However, we will go with the simplest backend&#8201;&#8212;&#8201;a
plain database file.</p></div>
<div class="paragraph"><p>Let&#8217;s create the user name / password database file in the default location
<code>/etc/sasldb2</code>, with a single user named <code>smtp</code> (we can change the user name to
anything we want):</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo saslpasswd2 -c -u example.com smtp
</pre></div></div></div>
<div class="paragraph"><p>Verify with:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo sasldblistusers2
</pre></div></div></div>
<div class="paragraph"><p>Now, we make sure only Postfix can read this file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo chmod <span class="m">400</span> /etc/sasldb2
<span class="nv">$ </span>sudo chown postfix /etc/sasldb2
</pre></div></div></div>
<div class="paragraph"><p>Lastly, we tell Cyrus SASL to use the file-based database to authenticate.
Create the file <code>/etc/postfix/sasl/smtpd.conf</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>pwcheck_method: auxprop
auxprop_plugin: sasldb
mech_list: PLAIN LOGIN CRAM-MD5 DIGEST-MD5 NTLM
log_level: 7</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_ssl_certificate">SSL Certificate</h4>
<div class="paragraph"><p>We need an SSL certificate to enable TLS. While a proper SSL certificate signed
by a Certificate Authority (CA) can be pricey, it turns out that a simple
self-signed certificate suffices and works just fine.</p></div>
<div class="paragraph"><p>So, let&#8217;s generate one.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<strong>Generate an RSA private/public key pair.</strong> Note that you MUST supply a password
  to this command; the password will be removed in step 3.
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>openssl genrsa -des3 -out example.key 1024
</pre></div></div></div>
</li>
<li>
<p>
<strong>Generate a Certificate Signing Request (CSR).</strong> Make sure to enter
  <code>myserver.example.com</code> when prompted for the "Common Name".
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>openssl req -new -key example.key -out example.csr
</pre></div></div></div>
</li>
<li>
<p>
<strong>Remove RSA private/public key password.</strong>
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>mv example.key example.key.orig
<span class="nv">$ </span>openssl rsa -in example.key.orig -out example.key
</pre></div></div></div>
</li>
<li>
<p>
<strong>Generate a self-signed certificate.</strong> In the example, the generated
  certificate will be valid for 10 years.
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>openssl x509 -req <span class="se">\</span>
    -days <span class="m">3650</span> -in example.csr -signkey example.key -out example.crt
</pre></div></div></div>
</li>
<li>
<p>
<strong>Create a PEM file.</strong>
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>cat example.crt example.key &gt; example.pem
</pre></div></div></div>
</li>
<li>
<p>
<strong>Move and protect the PEM file.</strong>
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo mv example.pem /etc/postfix/example.pem
<span class="nv">$ </span>sudo chmod <span class="m">400</span> /etc/postfix/example.pem
<span class="nv">$ </span>sudo chown postfix /etc/postfix/example.pem
</pre></div></div></div>
</li>
</ol></div>
<div class="paragraph"><p><strong>Note:</strong> Make sure to protect the generated private key and certificate with care!</p></div>
</div>
<div class="sect3">
<h4 id="_relay_server">Relay server</h4>
<div class="paragraph"><p>The final step is to configure Postfix to enable relaying of e-mail on behalf of
Gmail.</p></div>
<div class="paragraph"><p>Let&#8217;s open up <code>/etc/postfix/master.cf</code>. This file should already contain a bunch
of config options, some of which are commented out. Uncomment the lines starting
with <code>submission</code> and edit them to match the following:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>submission inet n       -       n       -       -       smtpd
  -o syslog_name=postfix/submission
  -o smtpd_tls_security_level=may
  -o smtpd_tls_cert_file=/etc/postfix/example.pem
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_reject_unlisted_recipient=no
  -o smtpd_relay_restrictions=permit_sasl_authenticated,reject
  -o milter_macro_daemon_name=ORIGINATING</code></pre>
</div></div>
<div class="paragraph"><p>A Postfix restart is due after all these changes:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>sudo postfix reload
</pre></div></div></div>
<div class="paragraph"><p>If all went well, you should see Postfix serving a relay server, protected by
our user name and password in <code>/etc/sasldb2</code>, on port 587.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_configure_gmail">Step 4: Configure Gmail</h3>
<div class="paragraph"><p>Finally, let&#8217;s log in to Gmail and tell it about our brand new server. (Note
that the new Inbox UI does not yet support all the settings available in the
legacy interface at the time of writing, so these instructions apply to the
legacy interface.)</p></div>
<div class="paragraph"><p>Let&#8217;s go to <em>Settings</em> &gt; <em>Accounts and Import</em> and click <em>Add another email
address you own</em>.
<div align="center"><img src="/assets/files/gmail_1.png"></div>
In the dialog that pops up, fill in our target e-mail address and click <em>Next
Step</em>.
<div align="center"><img src="/assets/files/gmail_2.png"></div>
In the next dialog, enter the address of our e-mail server
(<code>myserver.example.com</code>), and the user name and password we set up using
<code>saslpasswd2</code> above. Make sure the user name is suffixed with our domain name
(so <code>smtp@example.com</code> rather than just <code>smtp</code>). Check that the correct port
(587) and the correct security protocol (TLS) are selected, then click <em>Add
Account</em>.
<div align="center"><img src="/assets/files/gmail_3.png"></div>
If all goes well, we should see a dialog like the following:
<div align="center"><img src="/assets/files/gmail_4.png"></div>
And we should receive an e-mail, forwarded by our mail server set up in the
first part, to our <code>john123@gmail.com</code> address. Click on the link inside the
e-mail and we&#8217;re done!</p></div>
<div class="paragraph"><p>Now, in any e-mail compose / reply window, you should be able to select
<code>john@example.com</code> in the drop-down list next to "From". Congrats!</p></div>
<div class="paragraph"><p>If, on the other hand, you see an error like the following:
<div align="center"><img src="/assets/files/gmail_5.png"></div>
You should check the Postfix logs at <code>/var/log/mail.log</code> (or with <code>journalctl -u
postfix</code> if using Systemd) for any errors.</p></div>
</div>
<div class="sect2">
<h3 id="_optional_step_5_setup_dkim_and_srs">[Optional] Step 5: Setup DKIM and SRS</h3>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/DomainKeys_Identified_Mail">DKIM</a>, short for
<em>DomainKeys Identified Mail</em>, is e-mail validation system for preventing e-mail
spoofing. <a href="https://support.google.com/mail/answer/180707?hl=en">Google recommends
setting up DKIM</a>; if we don&#8217;t, the e-mail messages that we forward to Gmail have
a higher probability of getting marked as spam.</p></div>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Sender_Rewriting_Scheme">SRS</a>, short for <em>Sender
Rewriting Scheme</em>, is a relatively new standard that e-mail forwarding servers
are recommended to adopt, and it also helps reduce the likelihood of our
forwarded e-mail messages getting marked as spam.</p></div>
<div class="paragraph"><p>Thus, while technically optional, it&#8217;s a good idea to configure our Postfix
server to support both these standards. See my follow-up tutorial on
<a href="/posts/setting-up-dkim-and-srs-in-postfix.html">Setting Up DKIM And SRS In
Postfix</a> for a detailed step-by-step guide.</p></div>
</div>
<div class="sect2">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph"><p>In this post, we have set up a Postfix e-mail server that accomplishes the
following:</p></div>
<div class="ulist"><ul>
<li>
<p>
E-mails sent to <code>john@example.com</code> is received by Postfix on
  <code>myserver.example.com</code> port 25, and forwarded to <code>john123@gmail.com</code>;
</p>
</li>
<li>
<p>
Gmail will let you select <code>john@example.com</code> as a "from" address when
  composing / replying to an e-mail, and will relay such e-mails through Postfix
  on <code>myserver.example.com</code> port 587 using a configured user name / password
  combination.
</p>
</li>
</ul></div>
<div class="paragraph"><p>I hope you found this guide useful, and if you have any thoughts / questions,
you&#8217;re more than welcome to leave a comment below. Cheers!</p></div>
</div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Nov 06, 2014
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="https://seasonofcode.com/tag/featured.html">Featured</a>,          <a href="https://seasonofcode.com/tag/misc.html">Misc</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="https://seasonofcode.com/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="https://seasonofcode.com/posts/custom-domain-e-mails-with-postfix-and-gmail-the-missing-tutorial.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article><div id="author-box">
  <table id="author-box-content">
    <tr>
      <td>
        <a rel="author" href="https://plus.google.com/115396580584561637180">
          <div id="author-box-image"
            style="background-image: url(//graph.facebook.com/593659245/picture?type=large)"></div>
        </a>
      </td>
      <td id="author-box-info">
        <p id="author-box-info-title">
          About the author
        </p>
        <p id="author-box-info-bio">
          
I am a software engineer by profession and a passionate technology geek in
my free time.

        </p>
        <p id="author-box-info-links">
          <a href="https://github.com/jichu4n">
            <i class="fa fa-2x fa-github-square"></i><span class="author-box-info-link-expansion">github.com/jichu4n</span>
          </a>
          &nbsp;
          <a href="https://twitter.com/jichu4n">
            <i class="fa fa-2x fa-twitter-square"></i><span class="author-box-info-link-expansion">@jichu4n</span>
          </a>
          &nbsp;
          <a href="https://www.linkedin.com/in/chuanji">
            <i class="fa fa-2x fa-linkedin-square"></i><span class="author-box-info-link-expansion">Chuan Ji</span>
          </a>
          &nbsp;
          <a href="mailto:ji@chu4n.com">
            <i class="fa fa-2x fa-envelope-o"></i><span class="author-box-info-link-expansion">ji@chu4n.com</span>
          </a>
        </p>
      </td>
    </tr>
  </table>
</div><!-- Comment BEGIN -->
<p></p><p></p>
<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'cjix';
  (function() {
      var s = document.createElement('script');
      s.async = true;
      s.type = 'text/javascript';
      s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('HEAD')[0] ||
       document.getElementsByTagName('BODY')[0]).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<!-- Comment END -->
  </section>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p class="footer-text text-muted">&copy; 2015 Chuan Ji</p>
      </div>
    </footer>
    <script src="https://seasonofcode.com/theme/jquery.min.js"></script>
    <script src="https://seasonofcode.com/theme/bootstrap/js/bootstrap.min.js"></script>

<script type="text/javascript">
  var disqus_shortname = 'cjix';
  (function () {
      var s = document.createElement('script');
      s.async = true;
      s.type = 'text/javascript';
      s.src = '//' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] ||
       document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

  </body>
</html>
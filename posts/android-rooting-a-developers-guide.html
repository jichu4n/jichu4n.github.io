<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <title>Android Rooting: A Developer's Guide - Season of Code</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="shortcut icon" href="https://seasonofcode.com/assets/favicon.ico" />
      <link href="https://seasonofcode.com/theme/asciidoc.min.css?0e298cf5" rel="stylesheet" />
    <link href="https://seasonofcode.com/theme/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://seasonofcode.com/theme/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
      <link href="https://seasonofcode.com/theme/style.min.css?918c51a9" rel="stylesheet" />
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://seasonofcode.com/theme/html5shiv.min.js"></script>
    <script src="https://seasonofcode.com/theme/respond.min.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://seasonofcode.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Season of Code Full Atom Feed" />
    <link href="https://seasonofcode.com/feeds/misc.atom.xml" type="application/atom+xml" rel="alternate" title="Season of Code Categories Atom Feed" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-21264754-1', 'auto');
  ga('send', 'pageview');

</script>

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(["setDomains", ["*.seasonofcode.com"]]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//a.chu4n.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 2]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'js/'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//a.chu4n.com/piwik.php?idsite=2" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

    <meta name="google-site-verification" content="g_MrQjKfWWKOccQYg--leY8NlSev0om0sy2vrBLYoZU">
    <meta name="google-site-verification" content="_r0m7LYlH2JjDgeTysX9Fv0OzQG1xUEAU6x2uSr9nH8">

    <meta name="msvalidate.01" content="F10D3C66876F50983761BFE53E2B943A4">

  <link rel="canonical" href="https://seasonofcode.com/posts/android-rooting-a-developers-guide.html">
  </head>
  <body id="index" class="archive">
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <nav id="header" class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <i class="fa fa-bars fa-lg"></i>
          </button>
          <a class="navbar-brand" href="https://seasonofcode.com">
            season <span class="of">of</span> code
          </a>
        </div>
        <div class="collapse navbar-collapse navbar-right">
          <ul class="nav navbar-nav">
            <li>
              <a href="https://seasonofcode.com/tag/featured.html">Featured</a>
            </li>
            <li id="header-tags-dropdown" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                role="button">Tags <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu">
                  <li><a href="https://seasonofcode.com/tag/android.html">Android</a></li>
                  <li><a href="https://seasonofcode.com/tag/c.html">C++</a></li>
                  <li><a href="https://seasonofcode.com/tag/featured.html">Featured</a></li>
                  <li><a href="https://seasonofcode.com/tag/linux.html">Linux</a></li>
                  <li><a href="https://seasonofcode.com/tag/misc.html">Misc</a></li>
                  <li><a href="https://seasonofcode.com/tag/projects.html">Projects</a></li>
                  <li><a href="https://seasonofcode.com/tag/python.html">Python</a></li>
                  <li><a href="https://seasonofcode.com/tag/window-manager.html">Window Manager</a></li>
              </ul>
            </li>
            <li>
              <a href="https://seasonofcode.com/archives.html">Archives</a>
            </li>
            <li><a href="https://seasonofcode.com/pages/about.html">About</a></li>
          </ul>
        </div>
        <!-- /.navbar-collapse -->
      </div>
    </nav>
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-8 col-md-offset-2">
  <section id="content" class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="https://seasonofcode.com/posts/android-rooting-a-developers-guide.html" rel="bookmark">
      Android Rooting: A Developer's Guide
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2012-11-21T00:58:12-08:00">
          Nov 21, 2012
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="https://seasonofcode.com/tag/android.html">Android</a>,            <a href="https://seasonofcode.com/tag/featured.html">Featured</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="https://seasonofcode.com/posts/android-rooting-a-developers-guide.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p><img src="/assets/files/rooting_android_blue.jpg"
align="right"
style="max-width: 350px; width: 35%; margin: 1.5em 0 1.5em 1.5em;">
First things first&#8201;&#8212;&#8201;this is not about how to apply a rooting method, e.g., a
one-click-root, to an Android device. Rather, it is about how one could go about
<em>developing</em> a rooting method for a device that no one has rooted before, and is
told through my experiences with rooting a particular device&#8201;&#8212;&#8201;the Barnes &amp;
Noble Nook Tablet 8GB. For context, you can read my original thread
"<a href="http://forum.xda-developers.com/showthread.php?t=1529553">Root for Nook
Tablet 8GB (w/ Android Market)</a> on XDA-Developers where I published my rooting
method, which has reached a download count of&#8201;&#8212;&#8201;wait for it&#8201;&#8212;&#8201;OVER NINE
THOUSAND!!!</p></div>
<div class="paragraph"><p>For an overview of how rooting works behind the scenes, you may want to read my
previous article
<a href="/posts/how-rooting-works-a-technical-explanation-of-the-android-rooting-process.html">How
Rooting Works - A Technical Explanation of the Android Rooting Process</a> as
background.</p></div>
<div class="paragraph"><p>Sometime in late February (2012), on a visit to to a Barnes &amp; Noble store in
Boston, I bought the then freshly released Nook Tablet 8GB entirely on impulse
for $199. Being the hax0r that I am, the first thing I did when I got home was
to try to root the device. It came as a nasty surprise, therefore, when I
discovered that no one had yet succeeded in rooting the device. All I could find
was a <a href="http://www.youtube.com/watch?v=x8e0OLWQYc4">YouTube video</a> showing
that the existing rooting method for its cousin, the Nook Tablet 16GB, did not
work. After waiting for a few days, the absolutely pathetic app store and
handicaps instituted by B&amp;N finally motivated me to develop a rooting method for
the device myself.</p></div>
<div class="sect2">
<h3 id="_the_plan">The Plan</h3>
<div class="paragraph"><p>So, how do you go about rooting an Android device? As I explain in
<a href="/posts/how-rooting-works-a-technical-explanation-of-the-android-rooting-process.html">my
previous article</a>, rooting is basically a two-step process:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Find exploit that allows execution of arbitrary code as root
</p>
</li>
<li>
<p>
Use exploit to install <code>su</code> (with SUID bit set) and <code>Superuser.apk</code> as root
</p>
</li>
</ol></div>
<div class="paragraph"><p>After <code>su</code> and <code>Superuser.apk</code> are installed correctly, apps that require root
(such as <a href="http://matrixrewriter.com/android/">Titanium Backup</a> or
<a href="https://play.google.com/store/apps/details?id=org.adaway&amp;hl=en">AdAway</a>)
will invoke <code>su</code> to run code as the privileged user.</p></div>
</div>
<div class="sect2">
<h3 id="_the_process">The Process</h3>
<div class="paragraph"><p>There are many generic or device-specific exploits that a hax0r may leverage to
achieve privileged execution of arbitrary code. I would again refer you to
<a href="http://jon.oberheide.org/files/bsides11-dontrootrobots.pdf">this excellent
presentation on various Android root exploits</a> that have been or may still be
used for this purpose.</p></div>
<div class="paragraph"><p>However, none of these methods that I knew of could work on the Nook Tablet,
which is probably one of the most locked-down Android ROMs out there:</p></div>
<div class="ulist"><ul>
<li>
<p>
Bootloader is locked.
</p>
</li>
<li>
<p>
ADB is disabled, and cannot be enabled from the UI.
</p>
</li>
<li>
<p>
Installing non-market apps (raw APKs) is disabled, and cannot be enabled from the UI.
</p>
</li>
<li>
<p>
No access to Google Play / Android Market (or any Google Apps).
</p>
</li>
</ul></div>
<div class="paragraph"><p>This rules out 1) root APKs and 2) the majority of exploits out there that
require executing commands over ADB. It means that one cannot run any code on
the device that does not come from B&amp;N period.</p></div>
<div class="paragraph"><p>But of course there was another way in. Somebody on XDA-Developers had
discovered that the bootloader of the Nook Tablet supported booting off an
Android system located in partition images stored on an external microSD card.
This mechanism is probably used to repair corrupted system partitions by B&amp;N
customer support.</p></div>
<div class="paragraph"><p>The solution, then, is clear: we create dummy system partition images that,
instead of booting an Android system, installs <code>su</code> and <code>Superuser.apk</code> into the
"normal" Android system in internal flash memory. More concretely, I modified
the system initialization file inside the initrd inside the boot partition image
to invoke a custom script that copied the relevant files into the <code>system</code>
partition in the internal flash memory.</p></div>
<div class="paragraph"><p>I based my work on
<a href="http://forum.xda-developers.com/showthread.php?t=1517513">bauwks&#8217;s 2nduboot
images</a> and used <a href="https://gitorious.org/ac100/abootimg">abootimg</a> to unpack
files in the boot partition image <code>boot.img</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># Extracts files in the boot partition image into the current directory.</span>
abootimg -x ./boot.img
<span class="c"># Extract files in the initrd cpio archive into the folder ./ramdisk/</span>
aboot-unpack-initrd ./initrd.img
</pre></div></div></div>
<div class="paragraph"><p>I changed the system initialization file <code>init.omap4430.rc</code> in the initrd to
mount the system partition of the internal flash memory at <code>/foo</code> rather than
<code>/system</code>, because later system initialization steps attempt to remount
<code>/system</code> as read-only and so on, and for some reason I could not disable that
behavior:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>on fs
    mkdir /foo
    mount ext4 /dev/block/platform/mmci-omap-hs.1/by-name/system /foo wait</code></pre>
</div></div>
<div class="paragraph"><p>I added the following to the system initialization file <code>init.rc</code> in the initrd to start my rooting script:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>service root_script /sbin/busybox ash /assets/run.sh
    oneshot</code></pre>
</div></div>
<div class="paragraph"><p>My rooting script, which I place in the directory <code>assets</code> in the initrd,
installs not only <code>su</code>, but also Google Play and other Google apps which are
missing from the Nook Tablet ROM:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># Install su and Superuser.apk</span>
/sbin/busybox cp /assets/su /foo/bin/
/sbin/busybox cp /assets/su /foo/xbin/
/sbin/busybox chmod <span class="m">06755</span> /foo/xbin/su
/sbin/busybox chmod <span class="m">06755</span> /foo/bin/su
/sbin/busybox cp /assets/Superuser.apk /foo/app/

<span class="c"># Install Busybox.</span>
/sbin/busybox cp /sbin/busybox /foo/xbin/
/sbin/busybox chmod <span class="m">06755</span> /foo/xbin/busybox

<span class="c"># Install Google Play and other Google apps.</span>
/sbin/busybox cp /assets/*.apk /foo/app/
/sbin/busybox cp /assets/com.google.android.maps..xml /foo/etc/permissions/
/sbin/busybox cp /assets/com.google.android.maps.jar /foo/framework/
/sbin/busybox cp /assets/libvoicesearch.so /foo/lib/

<span class="c"># Done.</span>
/sbin/busybox mount -o ro,remount /foo
</pre></div></div></div>
<div class="paragraph"><p>In accordance with the above script, I had placed all assets in the <code>assets</code>
directory inside the initrd, and the Busybox binary in <code>sbin</code> inside the initrd.
With all changes done, I pack everything back into a new boot.img:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c"># Build initrd cpio archive</span>
abootimg-pack-initrd initrd.img.new
<span class="c"># Build new boot.img using previously extracted components</span>
abootimg --create boot.img.new -f ./bootimg.cfg -k ./zImage -r ./initrd.img.new
</pre></div></div></div>
<div class="paragraph"><p>Then I replace the <code>boot.img</code> on the SD card image with my <code>boot.img.new</code>, and
the rooting method is done.</p></div>
</div>
<div class="sect2">
<h3 id="_final_words">Final words</h3>
<div class="paragraph"><p>The actual process, of course, was much, much more painful. The Nook Tablet&#8217;s
bootloader is very picky; some microSD cards just won&#8217;t work, there is a file
size limit on <code>boot.img</code>, etc.. It was also after much frustration that I
discovered the mount-to-<code>/foo</code> trick. And I could not even keep track of how
many factory restores I had to perform on the device to undo bad modifications.
But it was still a lot of fun, and the euphoria at the end and the feeling of
accomplishment when reply posts started rolling in and random people were
donating $5 as a token of their appreciation could not be overstated.</p></div>
<div class="paragraph"><p>Good luck rooting!</p></div>
</div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Nov 21, 2012
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="https://seasonofcode.com/tag/android.html">Android</a>,          <a href="https://seasonofcode.com/tag/featured.html">Featured</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="https://seasonofcode.com/posts/android-rooting-a-developers-guide.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="https://seasonofcode.com/posts/android-rooting-a-developers-guide.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article><div id="author-box">
  <table id="author-box-content">
    <tr>
      <td class="hidden-xs">
        <a rel="author" href="https://plus.google.com/115396580584561637180">
          <div id="author-box-image"
            style="background-image: url(//graph.facebook.com/593659245/picture?type=large)"></div>
        </a>
      </td>
      <td id="author-box-info">
        <p id="author-box-info-title">
          About the author
        </p>
        <p id="author-box-info-bio">
          
I am a software engineer by profession and a passionate technology geek in
my free time.

        </p>
        <p id="author-box-info-links">
          Check out
          <a href="/pages/about.html">my bio</a>, or find me on
          <a href="https://plus.google.com/115396580584561637180">Google+</a>.
        </p>
      </td>
    </tr>
  </table>
</div>
<!-- Comment BEGIN -->
<p></p><p></p>
<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'cjix';
  (function() {
      var s = document.createElement('script');
      s.async = true;
      s.type = 'text/javascript';
      s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('HEAD')[0] ||
       document.getElementsByTagName('BODY')[0]).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<!-- Comment END -->
  </section>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p class="footer-text text-muted">&copy; 2015 Chuan Ji</p>
      </div>
    </footer>
    <script src="https://seasonofcode.com/theme/jquery.min.js"></script>
    <script src="https://seasonofcode.com/theme/bootstrap/js/bootstrap.min.js"></script>

<script type="text/javascript">
  var disqus_shortname = 'cjix';
  (function () {
      var s = document.createElement('script');
      s.async = true;
      s.type = 'text/javascript';
      s.src = '//' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] ||
       document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

  </body>
</html>
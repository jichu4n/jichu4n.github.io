<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <title>Season of Code</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="shortcut icon" href="https://seasonofcode.com/assets/favicon.ico" />
      <link href="https://seasonofcode.com/theme/asciidoc.min.css?0e298cf5" rel="stylesheet" />
    <link href="https://seasonofcode.com/theme/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://seasonofcode.com/theme/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
      <link href="https://seasonofcode.com/theme/style.min.css?26e193e7" rel="stylesheet" />
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://seasonofcode.com/theme/html5shiv.min.js"></script>
    <script src="https://seasonofcode.com/theme/respond.min.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://seasonofcode.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Season of Code Full Atom Feed" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-21264754-1', 'auto');
  ga('send', 'pageview');

</script>

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(["setDomains", ["*.seasonofcode.com"]]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//a.chu4n.com/";
    _paq.push(['setTrackerUrl', u+'js/']);
    _paq.push(['setSiteId', 2]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'js/'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//a.chu4n.com/js/?idsite=2" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

    <meta name="google-site-verification" content="g_MrQjKfWWKOccQYg--leY8NlSev0om0sy2vrBLYoZU">
    <meta name="google-site-verification" content="_r0m7LYlH2JjDgeTysX9Fv0OzQG1xUEAU6x2uSr9nH8">

    <meta name="msvalidate.01" content="F10D3C66876F50983761BFE53E2B943A4">

  <meta name="robots" content="noindex, follow">
  </head>
  <body id="index" class="archive">
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <nav id="header" class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <i class="fa fa-bars fa-lg"></i>
          </button>
          <a class="navbar-brand" href="https://seasonofcode.com">
            season <span class="of">of</span> code
          </a>
        </div>
        <div class="collapse navbar-collapse navbar-right">
          <ul class="nav navbar-nav">
            <li>
              <a href="https://seasonofcode.com/tag/featured.html">Featured</a>
            </li>
            <li id="header-tags-dropdown" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                role="button">Tags <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu">
                  <li><a href="https://seasonofcode.com/tag/android.html">Android</a></li>
                  <li><a href="https://seasonofcode.com/tag/c.html">C++</a></li>
                  <li><a href="https://seasonofcode.com/tag/featured.html">Featured</a></li>
                  <li><a href="https://seasonofcode.com/tag/linux.html">Linux</a></li>
                  <li><a href="https://seasonofcode.com/tag/misc.html">Misc</a></li>
                  <li><a href="https://seasonofcode.com/tag/projects.html">Projects</a></li>
                  <li><a href="https://seasonofcode.com/tag/python.html">Python</a></li>
                  <li><a href="https://seasonofcode.com/tag/window-manager.html">Window Manager</a></li>
              </ul>
            </li>
            <li>
              <a href="https://seasonofcode.com/archives.html">Archives</a>
            </li>
            <li><a href="https://seasonofcode.com/pages/about.html">About</a></li>
          </ul>
        </div>
        <!-- /.navbar-collapse -->
      </div>
    </nav>
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-8 col-md-offset-2">
    <section id="content" class="content">
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="https://seasonofcode.com/posts/ugh.html" rel="bookmark">
      Ugh...
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2011-05-04T03:50:15-07:00">
          May 04, 2011
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="https://seasonofcode.com/tag/projects.html">Projects</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="https://seasonofcode.com/posts/ugh.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>Haven&#8217;t been able to work on NITDroid in a while&#8230;anyway I came across a couple of interesting links and I&#8217;ll look more into them when I get to it.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.kandroid.org/android_pdk/display_drivers.html">Android Porting Guide - Display Drivers</a> is a cool page that discusses implementing a framebuffer device driver for Android.
</p>
</li>
<li>
<p>
<a href="http://git.kernel.org/?p=linux/kernel/git/stable/linux-2.6.32.y.git;a=blob;f=Documentation/fb/framebuffer.txt">The Frame Buffer Device</a> in the Linux kernel documentation. This really isn&#8217;t a link, but it gives a good overview of what a framebuffer device driver looks like in Linux.
</p>
</li>
<li>
<p>
<a href="http://linuxconsole.sourceforge.net/fbdev/HOWTO/index.html">Linux Framebuffer Driver Writing HOWTO</a> was a wow-moment for me. Will have to follow this closer. I only hope it&#8217;s not too outdated as it was last updated in 2001.
</p>
</li>
</ul></div>
<div class="paragraph"><p>That&#8217;s it for now. This summer is going to be fun.</p></div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        May 04, 2011
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="https://seasonofcode.com/tag/projects.html">Projects</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="https://seasonofcode.com/posts/ugh.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="https://seasonofcode.com/posts/ugh.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="https://seasonofcode.com/posts/egl-context-preservation-on-android.html" rel="bookmark">
      EGL Context Preservation on Android
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2011-03-15T15:08:50-07:00">
          Mar 15, 2011
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="https://seasonofcode.com/tag/android.html">Android</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="https://seasonofcode.com/posts/egl-context-preservation-on-android.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>This is really a little note for myself but I came across the issue of the
preservation of the OpenGL context (or rather, the EGL context as we&#8217;re dealing
with OpenGL ES) of an application. On desktop systems, G3D assumes its GL
context is always preserved, either by the GPU or by the system. On Android,
however, it turns out that there are two possible scenarios that will cause a
running application to lose its EGL context. The first is when the user leaves
the application, e.g., by pressing the Home button or in the case of an incoming
call. There is in fact a function called setPreserveEGLContextOnPause(boolean)
in GLSurfaceView, which does exactly what the name suggests; however, in the
words of the API documentation, "whether the EGL context is actually preserved
or not depends upon whether the Android device that the program is running on
can support an arbitrary number of EGL contexts or not. Devices that can only
support a limited number of EGL contexts must release the EGL context in order
to allow multiple applications to share the GPU." There is also a
getPreserveEGLContextOnPause() function, but the documentation does not specify
whether this will return the actual preservation policy of the machine or only
whatever value we have set earlier via setPreserveEGLContextOnPause(boolean). I
looked up the source file in the Android source tree but these two functions are
newly added in Android 3.0 (whose code, being in beta, is apparently not
released to the public) and do not show up in the published code base.</p></div>
<div class="paragraph"><p>The second way we could lose the EGL context is when the user locks the screen
and the device goes to sleep. Again quoting the API documentation, "[t]he EGL
context will typically be lost when the Android device awakes after going to
sleep&#8230;Note that when the EGL context is lost, all OpenGL resources associated
with that context will be automatically deleted." There does not appear to exist
a way to prevent this.</p></div>
<div class="paragraph"><p>Whenever we will have lost a context and need to render again, the
onSurfaceCreated function in our renderer class is called with a newly created
context; this is where a Java app would send all its resources to the GPU. In
the case of the G3D library, I think the best we can do is to require our client
application to always provide some sort of callback on Android that we will
invoke to resend resources to the GPU, for instance in their GApp subclass.</p></div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Mar 15, 2011
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="https://seasonofcode.com/tag/android.html">Android</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="https://seasonofcode.com/posts/egl-context-preservation-on-android.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="https://seasonofcode.com/posts/egl-context-preservation-on-android.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="https://seasonofcode.com/posts/msys-and-ssh-server-under-windows-7.html" rel="bookmark">
      MSYS and SSH server under Windows 7
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2011-03-14T03:29:05-07:00">
          Mar 14, 2011
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="https://seasonofcode.com/tag/misc.html">Misc</a>,            <a href="https://seasonofcode.com/tag/featured.html">Featured</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="https://seasonofcode.com/posts/msys-and-ssh-server-under-windows-7.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>By order of The Professor, thou shalt install Windows 7 on thy lab machine. Alright, I can live with Windows, but I want my UNIX environment and I want SSH. I installed MinGW, MSYS, and got a basic UNIX environment working within a few minutes. It took me the better half of my weekend, however, to get an SSH server running that would allow me to use the Bash shell that comes with MSYS. I first tried <a href="http://www.freesshd.com/">freeSSHd</a>, but its terminal driver is crappy and I can&#8217;t even start Bash. <a href="http://mobassh.mobatek.net/">MobaSSH</a> comes with a copy of Cygwin, but my professor appears to have a grudge against Cygwin which is why I&#8217;m installing MinGW in the first place. I then tried <a href="http://www.kpym.com/">Kpym</a>; the personal version is so crippled I uninstalled it within five minutes. I tried <a href="http://sshwindows.sourceforge.net/">OpenSSH for Windows</a>, but it does not appear to work on Windows 7 at all. Finally, I discovered <a href="http://www.bitvise.com/winsshd">WinSSHD</a>. Setting the shell was a weird process; you had to go to Advanced Settings &#8594; Access Control &#8594; Windows Groups and change the default shell associated with "everyone" (I mean, what does this have to do with access control?) but when I changed the default shell to <code>C:MinGWmsys1.0bash.exe -il</code>, magic happened. However, vim was refusing to launch, and the vi binary that came with MSYS complained about the terminal type being unrecognizable. I screwed around a little bit and discovered that the solution was to open up the environment settings window from Control Panel and change the environment variable <code>CYGWIN</code> from <code>tty</code> to <code>notty</code>. The installer of WinSSHD adds this environment variable to Windows 7, but it appears to be entirely unnecessary and in my case counterproductive. Who cares though; the SSH server is running beautifully, and I can login directly to the MSYS Bash. Yay!!</p></div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Mar 14, 2011
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="https://seasonofcode.com/tag/misc.html">Misc</a>,          <a href="https://seasonofcode.com/tag/featured.html">Featured</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="https://seasonofcode.com/posts/msys-and-ssh-server-under-windows-7.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="https://seasonofcode.com/posts/msys-and-ssh-server-under-windows-7.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="https://seasonofcode.com/posts/nitdroid-userland-update.html" rel="bookmark">
      NITDroid userland update
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2011-02-19T04:37:25-08:00">
          Feb 19, 2011
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="https://seasonofcode.com/tag/projects.html">Projects</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="https://seasonofcode.com/posts/nitdroid-userland-update.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>Although I haven&#8217;t been able to make much progress, I thought I&#8217;d post an update
on NITDroid for documentation purposes. I&#8217;ve been working on the Android
userland and it hasn&#8217;t been easy so far.</p></div>
<div class="paragraph"><p>I started off by following <a href="http://elinux.org/Android_on_OMAP">this page</a> on
eLinux.org again; the idea was to extract userland files from the system images
provided by the SDK for emulation on QEMU. I tried this method with Gingerbread
images; however, it did not take me long to notice that these images are missing
important components - for example, the DBUS daemon, <code>/system/bin/dbus-daemon</code>
and its associated library and config file are not present, despite being named
as startup services in <code>init.rc</code>. A little research showed me that the so-called
"SDK builds" have indeed different configurations than normal builds.</p></div>
<div class="paragraph"><p>The natural conclusion is that I should manually build the images from source,
as explained <a href="http://source.android.com/source/download.html">here</a> on the
Android open source project page. It was not as straightforward as the page
claimed, however:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
I check out the code using <code>repo init -u git://whatever.git -b gingerbread</code>,
and try to build. I am told that anything from Froyo up required a 64-bit host
system. I check out Froyo by <code>repo init -b froyo</code>, and am told that branch did
not exist. Fine; how abaout <code>repo init -b froyo-plus-aosp</code>? No, STILL requires a
64-bit system.
</p>
</li>
<li>
<p>
I spend an hour installing a full 64-bit Arch system on a CF card, forgetting to add <code>usb</code> to <code>mkinitcpio.conf</code>, and re-installing. I now boot into the new 64-bit system, and try building again. Now I am told my host system can&#8217;t build 32-bit binaries. Seriously, <em>WTF</em>?? Why on earth would the Android source make you build 32-bit binaries on a 64-bit system??
</p>
</li>
<li>
<p>
Alright, I&#8217;ll install <code>gcc-multilib</code> and friends from the multilib repository
(see
<a href="https://wiki.archlinux.org/index.php/Arch64_FAQ#Multilib_Repository_-_Multilib_Project">this page</a>
on the Arch wiki). Build.
</p>
</li>
<li>
<p>
The build process halts because I&#8217;m missing some tools. <code>yaourt -S gperf zip
unzip</code>. My bad.
</p>
</li>
<li>
<p>
I get <em>compile errors</em>. A completely useless component called MonkeyRunner
requires <code>javax.annotation.Nullable</code> which allows you to use <code>@Nullable</code> and
<code>@NotNull</code> in your Java code. How useful. <code>find sdk/monkeyrunner/src -type f
-exec sed -i <em>s/@Nullable//g</em> <em>{}</em> <em>;</em></code> etc.
</p>
</li>
<li>
<p>
More dependency errors, and no one else has ever run into this while building
Froyo. This sucks. I&#8217;ve already spent 12 hours on this. Giving up.
</p>
</li>
</ol></div>
<div class="paragraph"><p>I suddenly decided to test out the now abandoned N8x0 version of the NITDroid
project, which is based on Android 1.6 (Donut). I downloaded the rootfs,
extracted it to the SD card, and booted it up with my kernel. I could actually
boot to a UI telling me I&#8217;m running out of battery (I was) before it would
freeze and then die. Still, this shows me my display driver is working, although
of course it might not with Android 2.0+ (see
<a href="http://elinux.org/Android_on_OMAP#Blank_screen">here</a>). But that is
encouraging. I try my previous rootfs extracted from SDK images; I still get
only a blank screen after Zygote starts, probably due to the page flipping issue
and probably meaning the fix on that page does not actually work.</p></div>
<div class="paragraph"><p>Then, as stuck as I was, I found
<a href="http://groups.google.com/group/android-x86/browse_thread/thread/00aeaafa85eaaa31/f7ef2af3b7862048">this page</a>
which showed me that it is possible to build Froyo on a 32-bit system if
checked it out as <code>repo init -b android-&lt;version&gt;</code>. Then I found
<a href="http://groups.google.com/group/android-porting/browse_thread/thread/e939f7e86a555892">this
page</a> which discusses the possibility of modifying the source code of the
userland so that it does not require page flipping / double buffering; and
lastly but most interestingly, <a href="http://www.yuan.se/?p=7">this page</a> discusses
actually implementing double buffering in a kernel framebuffer driver.</p></div>
<div class="paragraph"><p>So I naturally checked out Froyo using <code>repo init -b android-2.2.1_r2</code> and when
instructed by the build script installed <code>jdk5</code> from the AUR (I had to patch the
PKGBUILD according to the comments and create a symlink from <code>/opt/java5</code> to
<code>/opt/java</code>). Froyo is happily compiling (for now), and I should go to
bed&#8230;I&#8217;ve done basically nothing else all day and it is 5am.</p></div>
<div class="paragraph"><p>UPDATE (02/19/2011): Froyo compiled without a problem using JDK5; looks like the compile errors I got before were due to differences between JDK5 and JDK6. I could never have figured that out if the build script hadn&#8217;t told me. But the built userland still freezes when launching Zygote; it seems framebuffer is the problem. I found <a href="https://sites.google.com/site/nitdroid/n900-port">this page</a> that gives a patch that supposedly allowed the N900 to boot into GUI despite its lack of page flipping support. I will investigate further later.</p></div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Feb 19, 2011
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="https://seasonofcode.com/tag/projects.html">Projects</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="https://seasonofcode.com/posts/nitdroid-userland-update.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="https://seasonofcode.com/posts/nitdroid-userland-update.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
        <section class="article content">
<article itemscope itemtype="http://schema.org/Article">
  <header>
    <h2 class="entry-title">
      <a itemprop="name" href="https://seasonofcode.com/posts/mmc-support-in-nitdroid-kernel.html" rel="bookmark">
      MMC support in NITDroid kernel
      </a>
    </h2>
    <!--googleoff: snippet-->
    <aside>
      <ul class="article-meta text-muted small">
        <li class="article-author">
          By <span itemprop="author">Chuan Ji</span>
        </li>
        <li class="spacer">|</li>
        <li class="article-date">
        <span itemprop="datePublished" content="2011-02-16T21:29:54-08:00">
          Feb 16, 2011
        </span>
        </li>
        <li class="spacer">|</li>
        <li>
          Tags:
            <a href="https://seasonofcode.com/tag/projects.html">Projects</a>        </li>
        <li class="spacer">|</li>
        <li class="article-comments-count">
          <a href="https://seasonofcode.com/posts/mmc-support-in-nitdroid-kernel.html#disqus_thread">Comments</a>
        </li>
      </ul>
    </aside>
    <!--googleon: snippet-->
  </header>

  <div itemprop="articleBody" class="entry-content">
    <div class="paragraph"><p>The kernel now supports both the internal and the external MMC. For some bizarre reason, all I had to do to get the external MMC to work was turn on <code>CONFIG_MENELAUS</code> and <code>CONFIG_MMC_OMAP</code>; the kernel was not crashing anymore unlike in the <a href="?p=79">this previous post</a> when I built the first bootable kernel. I guess my new approach of restarting from scratch and changing as little as possible paid off.</p></div>
<div class="paragraph"><p>I wasted hours getting the internal MMC to work, however. It turns out that the issue was not with the MMC driver in <code>drivers/mmc/host/omap.c</code> but with the Menelaus driver in <code>drivers/mfd/menelaus.c</code>; in fact, there was a f-ing <em>typo</em> in that file, as explained in <a href="http://lkml.org/lkml/2010/8/8/98">this email</a>. The fix isn&#8217;t in either the vanilla linux-omap 2.6.32 or the Android OMAP 2.6.32 tree, though, and it looks like the people over at Meego still haven&#8217;t figured it out (see <a href="http://forum.meego.com/showthread.php?p=3525">this thread</a>). Seriously, all the smart people at Intel, Nokia, AMD and Novel&#8230;</p></div>
<div class="paragraph"><p>Anyhow, <a href="/assets/files/nitdroid/bootable-mmc-20110216.diff">here</a> is the comprehensive diff file from commit 69a7364c16c5aeb246dbb4c4e7696e39841492f5 in the Android OMAP archive/android-omap-2.6.32 branch, and <a href="/assets/files/nitdroid/zImage-20110216">here</a> is the compiled zImage. Of course, sound and WiFi are still not working, among other things I suppose. On the other hand, looking forward, I think I&#8217;ll stop working on the kernel for now (believe me, I&#8217;m <em>sick</em> of diff&#8217;s and grep&#8217;s across five different kernel trees&#8230;) and instead start working on the userland. Or homework.</p></div>
<div class="paragraph"><p>UPDATE (02/16/2011): Screw homework. Just updated the linked files with Android support (according to <a href="http://elinux.org/Android_on_OMAP">this page</a>); this includes double buffering support in <code>omapfb_main.c</code>.</p></div>

  </div>

  <footer class="article-info text-muted small">
    <ul class="article-meta text-right">
      <li class="article-author">
        By Chuan Ji
      </li>
      <li class="spacer">|</li>
      <li class="article-date">
        Feb 16, 2011
      </li>
      <li class="spacer">|</li>
      <li>
        Tags:
          <a href="https://seasonofcode.com/tag/projects.html">Projects</a>      </li>
      <li class="spacer">|</li>
      <li class="article-comments-count">
        <a href="https://seasonofcode.com/posts/mmc-support-in-nitdroid-kernel.html#disqus_thread">Comments</a>
      </li>
      <li class="spacer">|</li>
      <li class="article-link">
        <a href="https://seasonofcode.com/posts/mmc-support-in-nitdroid-kernel.html">Permalink</a>
      </li>
    </ul>
  </footer>
</article>        </section>
        <div class="article-divider">
          <span class="bullet_1">&bull;</span>
          <span class="bullet_2">&bull;</span>
          <span class="bullet_3">&bull;</span>
          <span class="bullet_4">&bull;</span>
          <span class="bullet_5">&bull;</span>
        </div>
<div>
  <ul class="pager">
    <li class="previous"><a href="https://seasonofcode.com/index7.html">&larr; Previous</a></li>
    <li class="next"><a href="https://seasonofcode.com/index9.html">Next &rarr;</a></li>
  </ul>
</div>
    </section>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p class="footer-text text-muted">&copy; 2015 Chuan Ji</p>
      </div>
    </footer>
    <script src="https://seasonofcode.com/theme/jquery.min.js"></script>
    <script src="https://seasonofcode.com/theme/bootstrap/js/bootstrap.min.js"></script>

<script type="text/javascript">
  var disqus_shortname = 'cjix';
  (function () {
      var s = document.createElement('script');
      s.async = true;
      s.type = 'text/javascript';
      s.src = '//' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] ||
       document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

  </body>
</html>